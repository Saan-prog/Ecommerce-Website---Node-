<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ShopStyle - Admin Orders</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&family=Source+Code+Pro:wght@700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Open Sans", sans-serif;
        background-color: #f5f7fa;
        color: #333;
        line-height: 1.6;
      }

      /* Admin Layout */
      .admin-container {
        min-height: 100vh;
      }

      /* Sidebar */
      .admin-sidebar {
        width: 250px;
        background: #2c3e50;
        color: white;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        transition: all 0.3s;
        z-index: 1000;
      }

      .sidebar-brand {
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid #34495e;
        background: #1a252f;
      }

      .sidebar-brand h2 {
        font-size: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sidebar-brand i {
        margin-right: 10px;
        color: #e74c3c;
      }

      .sidebar-menu {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .sidebar-menu li a {
        color: #bdc3c7;
        padding: 15px 20px;
        display: block;
        text-decoration: none;
        transition: all 0.3s;
        border-left: 3px solid transparent;
      }

      .sidebar-menu li a:hover,
      .sidebar-menu li a.active {
        background: #34495e;
        color: white;
        border-left: 3px solid #e74c3c;
      }

      .sidebar-menu li a i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
      }

      /* Main Content */
      .admin-main {
        flex: 1;
        margin-left: 250px;
        transition: all 0.3s;
      }

      .admin-header {
        background: white;
        padding: 15px 30px;
        border-bottom: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .admin-user {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .admin-user span {
        color: #2c3e50;
        font-weight: 600;
      }

      .logout-btn {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
      }

      .logout-btn i {
        margin-right: 5px;
      }

      .admin-content {
        padding: 30px;
      }

      /* Order Summary Cards */
      .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .summary-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 15px;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .summary-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      }

      .summary-icon {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
      }

      .summary-icon.pending {
        background: linear-gradient(135deg, #f39c12, #e67e22);
      }

      .summary-icon.processing {
        background: linear-gradient(135deg, #3498db, #2980b9);
      }

      .summary-icon.shipped {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
      }

      .summary-icon.delivered {
        background: linear-gradient(135deg, #27ae60, #229954);
      }

      .summary-icon.cancelled {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
      }

      .summary-info h3 {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .summary-info p {
        color: #7f8c8d;
        font-size: 14px;
      }

      /* Simple Filter Section */
      .simple-filter {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
      }

      .status-filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .status-filter-btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: none;
        background: #ecf0f1;
        color: #7f8c8d;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }

      .status-filter-btn:hover {
        background: #d5dbdb;
      }

      .status-filter-btn.active {
        background: #3498db;
        color: white;
      }

      .reset-filter-btn {
        margin-left: auto;
        background: #95a5a6;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .reset-filter-btn:hover {
        background: #7f8c8d;
      }

      /* Orders Table Styles */
      .orders-table-container {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-top: 20px;
      }

      .orders-table {
        width: 100%;
        border-collapse: collapse;
      }

      .orders-table th {
        background: #34495e;
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #2c3e50;
      }

      .orders-table td {
        padding: 15px;
        border-bottom: 1px solid #ecf0f1;
        vertical-align: middle;
      }

      .orders-table tr:hover {
        background: #f8f9fa;
      }

      .orders-table tr:last-child td {
        border-bottom: none;
      }

      /* Order Info */
      .order-info {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .order-id {
        font-weight: 600;
        color: #2c3e50;
        font-size: 14px;
        cursor: pointer;
        transition: color 0.3s;
      }

      .order-id:hover {
        color: #3498db;
        text-decoration: underline;
      }

      .order-date {
        font-size: 12px;
        color: #7f8c8d;
      }

      /* Customer Info */
      .customer-info {
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .customer-name {
        font-weight: 600;
        color: #2c3e50;
      }

      .customer-email {
        font-size: 12px;
        color: #7f8c8d;
      }

      /* Status Badges */
      .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
        text-transform: uppercase;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-processing {
        background: #cce5ff;
        color: #004085;
      }

      .status-shipped {
        background: #d1ecf1;
        color: #0c5460;
      }

      .status-delivered {
        background: #d4edda;
        color: #155724;
      }

      .status-cancelled {
        background: #f8d7da;
        color: #721c24;
      }

      /* Payment Status */
      .payment-status {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .payment-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }

      .payment-paid {
        background: #27ae60;
      }

      .payment-pending {
        background: #f39c12;
      }

      .payment-failed {
        background: #e74c3c;
      }

      /* Action Buttons */
      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .btn-view {
        background: #3498db;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .btn-view:hover {
        background: #2980b9;
      }

      .btn-update {
        background: #2ecc71;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .btn-update:hover {
        background: #27ae60;
      }

      /* Pagination */
      .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 30px;
      }

      .pagination {
        display: flex;
        gap: 5px;
      }

      .page-item {
        display: inline-block;
      }

      .page-link {
        color: #3498db;
        border-radius: 4px;
        padding: 8px 12px;
        text-decoration: none;
        border: 1px solid #ddd;
        display: block;
      }

      .page-item.active .page-link {
        background: #3498db;
        color: white;
        border: 1px solid #3498db;
      }

      .page-item.disabled .page-link {
        color: #bdc3c7;
        cursor: not-allowed;
      }

      .page-link:hover {
        background: #e8f3fc;
      }

      /* Loading and Error States */
      .loading {
        text-align: center;
        padding: 40px;
        font-size: 16px;
        color: #7f8c8d;
      }

      .error {
        text-align: center;
        padding: 40px;
        font-size: 16px;
        color: #e74c3c;
        background: white;
        border-radius: 8px;
        margin: 20px 0;
      }

      .no-orders {
        text-align: center;
        padding: 40px;
        color: #7f8c8d;
        background: white;
        border-radius: 8px;
        margin: 20px 0;
      }

      /* Status Update Modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 8px;
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #ecf0f1;
        padding-bottom: 15px;
      }

      .modal-title {
        font-size: 24px;
        color: #2c3e50;
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        color: #7f8c8d;
        cursor: pointer;
      }

      .close-modal:hover {
        color: #e74c3c;
      }

      .status-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 20px 0;
      }

      .status-option {
        flex: 1;
        min-width: 120px;
      }

      .status-option input {
        display: none;
      }

      .status-option label {
        display: block;
        padding: 10px;
        text-align: center;
        border: 2px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .status-option input:checked + label {
        border-color: #3498db;
        background: #3498db;
        color: white;
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .admin-sidebar {
          width: 70px;
        }

        .admin-sidebar .sidebar-brand h2 span,
        .admin-sidebar .sidebar-menu li a span {
          display: none;
        }

        .admin-sidebar .sidebar-menu li a i {
          margin-right: 0;
          font-size: 18px;
        }

        .admin-main {
          margin-left: 70px;
        }

        .orders-table {
          display: block;
          overflow-x: auto;
        }

        .simple-filter {
          flex-direction: column;
          align-items: stretch;
        }

        .status-filter-buttons {
          justify-content: center;
        }

        .reset-filter-btn {
          margin-left: 0;
        }

        .summary-cards {
          grid-template-columns: 1fr;
        }

        .modal-content {
          width: 95%;
          margin: 2% auto;
          padding: 15px;
        }

        .action-buttons {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <!-- Sidebar -->
      <div class="admin-sidebar">
        <div class="sidebar-brand">
          <h2>
            <i class="fas fa-user-shield"></i> <span>ShopStyle Admin</span>
          </h2>
        </div>
        <ul class="sidebar-menu">
          <li>
            <a href="admin-dashboard.html"
              ><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a
            >
          </li>
          <li>
            <a href="admin-showusers.html"
              ><i class="fas fa-users"></i> <span>Users</span></a
            >
          </li>
          <li>
            <a href="admin-orders.html" class="active"
              ><i class="fas fa-shopping-cart"></i> <span>Orders</span></a
            >
          </li>
          <li>
            <a href="admin-products.html"
              ><i class="fas fa-box"></i> <span>Products</span></a
            >
          </li>
          <li>
            <a href="admin-categories.html"
              ><i class="fas fa-tags"></i> <span>Categories</span></a
            >
          </li>
          <li>
            <a href="admin-coupon.html"
              ><i class="fas fa-warehouse"></i> <span>Coupons</span></a
            >
          </li>
          <li>
            <a href="admin-reports.html"
              ><i class="fas fa-chart-bar"></i> <span>Reports</span></a
            >
          </li>
          <li>
            <a href="#" id="logoutBtn"
              ><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a
            >
          </li>
        </ul>
      </div>

      <!-- Main Content -->
      <div class="admin-main">
        <div class="admin-header">
          <h1>Order Management</h1>
          <div class="admin-user">
            <span id="adminNameDisplay">Admin</span>
            <button class="logout-btn" id="logoutBtnHeader">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>

        <div class="admin-content">
          <!-- Order Summary Cards -->
          <div class="summary-cards" id="summaryCards">
            <div class="summary-card" onclick="loadOrders(1, 'all')">
              <div class="summary-icon pending">
                <i class="fas fa-box"></i>
              </div>
              <div class="summary-info">
                <h3 id="allCount">0</h3>
                <p>All Orders</p>
              </div>
            </div>
            <div class="summary-card" onclick="loadOrders(1, 'pending')">
              <div class="summary-icon pending">
                <i class="fas fa-clock"></i>
              </div>
              <div class="summary-info">
                <h3 id="pendingCount">0</h3>
                <p>Pending Orders</p>
              </div>
            </div>
            <div class="summary-card" onclick="loadOrders(1, 'processing')">
              <div class="summary-icon processing">
                <i class="fas fa-cog"></i>
              </div>
              <div class="summary-info">
                <h3 id="processingCount">0</h3>
                <p>Processing</p>
              </div>
            </div>
            <div class="summary-card" onclick="loadOrders(1, 'shipped')">
              <div class="summary-icon shipped">
                <i class="fas fa-shipping-fast"></i>
              </div>
              <div class="summary-info">
                <h3 id="shippedCount">0</h3>
                <p>Shipped</p>
              </div>
            </div>
            <div class="summary-card" onclick="loadOrders(1, 'delivered')">
              <div class="summary-icon delivered">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="summary-info">
                <h3 id="deliveredCount">0</h3>
                <p>Delivered</p>
              </div>
            </div>
            <div class="summary-card" onclick="loadOrders(1, 'cancelled')">
              <div class="summary-icon cancelled">
                <i class="fas fa-times-circle"></i>
              </div>
              <div class="summary-info">
                <h3 id="cancelledCount">0</h3>
                <p>Cancelled</p>
              </div>
            </div>
          </div>

          <!-- Simple Status Filter -->
          <div class="simple-filter">
            <div class="status-filter-buttons" id="statusFilterButtons">
              <button class="status-filter-btn active" data-status="all">
                All Orders
              </button>
              <button class="status-filter-btn" data-status="pending">
                Pending
              </button>
              <button class="status-filter-btn" data-status="processing">
                Processing
              </button>
              <button class="status-filter-btn" data-status="shipped">
                Shipped
              </button>
              <button class="status-filter-btn" data-status="delivered">
                Delivered
              </button>
              <button class="status-filter-btn" data-status="cancelled">
                Cancelled
              </button>
            </div>
            <button class="reset-filter-btn" onclick="loadOrders(1, 'all')">
              <i class="fas fa-redo"></i> Show All Orders
            </button>
          </div>

          <!-- Orders Table -->
          <div class="orders-table-container">
            <table class="orders-table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Payment</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="orders-table-body">
                <tr>
                  <td colspan="7" class="loading">Loading orders...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="pagination-container">
            <ul class="pagination" id="pagination-container">
              <!-- Pagination will be loaded here dynamically -->
            </ul>
          </div>
        </div>
      </div>
    </div>


    <!-- JavaScript -->
       <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <script>
      const notyf = new Notyf({
    duration: 3000, // 3 seconds
    position: {
      x: 'right',
      y: 'top',
    },
    types: [
      {
        type: 'success',
        background: '#28a745',
        icon: {
          className: 'fas fa-check-circle',
          tagName: 'i',
          color: '#fff'
        }
      },
      {
        type: 'error',
        background: '#dc3545',
        icon: {
          className: 'fas fa-exclamation-circle',
          tagName: 'i',
          color: '#fff'
        }
      },
      {
        type: 'warning',
        background: '#ffc107',
        icon: {
          className: 'fas fa-exclamation-triangle',
          tagName: 'i',
          color: '#fff'
        }
      },
      {
        type: 'info',
        background: '#17a2b8',
        icon: {
          className: 'fas fa-info-circle',
          tagName: 'i',
          color: '#fff'
        }
      }
    ]
  });

      // Authentication check
      (function checkAuth() {
        const token = localStorage.getItem("adminToken");
        const isLoggedIn = localStorage.getItem("adminLoggedIn") === "true";

        if (!token || !isLoggedIn) {
          window.location.href = "admin-login.html";
          return;
        }
      })();

      let currentPage = 1;
      const ordersPerPage = 10;
      let currentStatus = "all";
      let currentOrderId = null;

      // Load orders from API
      async function loadOrders(page = 1, status = "all") {
        try {
          const token = localStorage.getItem("adminToken");
          if (!token) {
            window.location.href = "admin-login.html";
            return;
          }

          currentPage = page;
          currentStatus = status;
          
          // Update active filter button
          updateActiveFilterButton(status);
          
          const tableBody = document.getElementById("orders-table-body");
          tableBody.innerHTML =
            '<tr><td colspan="7" class="loading">Loading orders...</td></tr>';

          // Build query parameters
          const params = new URLSearchParams({
            page: page,
            limit: ordersPerPage,
          });

          // Add status filter if not "all"
          if (status && status !== "all") {
            params.append("status", status);
          }

          console.log("Fetching orders from:", `http://localhost:8070/api/admin/orders/getAll?${params.toString()}`);

          const response = await fetch(
            `http://localhost:8070/api/admin/orders/getAll?${params.toString()}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (!response.ok) {
            if (response.status === 401) {
              notyf.error("Session expired. Please login again.");
              setTimeout(() => {
                window.location.href = "admin-login.html";
              }, 1500);
              
              return;
            }
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          console.log("Orders data:", data);

          if (data.success) {
            // Update summary counts
            if (data.counts) {
              updateSummaryCounts(data.counts);
            }
            
            renderOrdersTable(data.orders);
            setupPagination(data.pagination);
          } else {
            throw new Error(data.message || "Failed to load orders");
          }
        } catch (error) {
          console.error("Error loading orders:", error);
          document.getElementById("orders-table-body").innerHTML =
            '<tr><td colspan="7" class="error">Error loading orders. Please try again.</td></tr>';
        }
      }

      // Update summary counts on the cards
      function updateSummaryCounts(counts) {
        document.getElementById("allCount").textContent = counts.all || 0;
        document.getElementById("pendingCount").textContent = counts.pending || 0;
        document.getElementById("processingCount").textContent = counts.processing || 0;
        document.getElementById("shippedCount").textContent = counts.shipped || 0;
        document.getElementById("deliveredCount").textContent = counts.delivered || 0;
        document.getElementById("cancelledCount").textContent = counts.cancelled || 0;
      }

      // Update active filter button
      function updateActiveFilterButton(status) {
        const buttons = document.querySelectorAll(".status-filter-btn");
        buttons.forEach(button => {
          const buttonStatus = button.getAttribute("data-status");
          if (buttonStatus === status) {
            button.classList.add("active");
          } else {
            button.classList.remove("active");
          }
        });
      }

      // Render orders table
      function renderOrdersTable(orders) {
        const tableBody = document.getElementById("orders-table-body");
        tableBody.innerHTML = "";

        if (!orders || orders.length === 0) {
          tableBody.innerHTML =
            '<tr><td colspan="7" class="no-orders">No orders found for this status.</td></tr>';
          return;
        }

        orders.forEach((order) => {
          // Format date
          // const orderDate = new Date(order.rawDate || order.createdAt);
          const formattedDate = order.date || orderDate.toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric",
          });

          // Get status badge class based on statusValue
          const statusValue = order.statusValue || order.status;
          let statusClass = "";
          let statusText = order.status;
          
          switch (statusValue.toLowerCase()) {
            case "created":
            case "confirmed":
            case "pending":
              statusClass = "status-pending";
              statusText = "Pending";
              break;
            case "shipped":
            case "out for delivery":
            case "processing":
              statusClass = "status-processing";
              statusText = "Processing";
              break;
            case "delivered":
              statusClass = "status-delivered";
              statusText = "Delivered";
              break;
            case "cancelled":
              statusClass = "status-cancelled";
              statusText = "Cancelled";
              break;
            default:
              statusClass = "status-pending";
          }

          // Get payment status
          const paymentStatus = order.paymentStatus || order.payment;
          let paymentClass = "";
          let paymentText = paymentStatus;
          
          if (paymentStatus === "PAID" || paymentText === "Paid") {
            paymentClass = "payment-paid";
            paymentText = "Paid";
          } else if (paymentStatus === "PENDING" || paymentText === "Pending") {
            paymentClass = "payment-pending";
            paymentText = "Pending";
          } else if (paymentStatus === "FAILED") {
            paymentClass = "payment-failed";
            paymentText = "Failed";
          }

          const orderRow = `
          <tr>
            <td>
              <div class="order-info">
                <div class="order-id" onclick="redirectToOrderUpdate('${
                  order._id
                }')">
                  ${order.orderId}
                </div>
              </div>
            </td>
            <td>
              <div class="customer-info">
                <div class="customer-name">${order.customer?.name || order.customer || "Customer"}</div>
                <div class="customer-email">${order.customer?.email || "N/A"}</div>
              </div>
            </td>
            <td>${formattedDate}</td>
            <td>
              <strong>${order.formattedAmount || order.amount || "â‚¹0.00"}</strong>
            </td>
            <td>
              <span class="status-badge ${statusClass}">${statusText}</span>
            </td>
            <td>
              <div class="payment-status">
                <span class="payment-dot ${paymentClass}"></span>
                <span>${paymentText}</span>
              </div>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-view" onclick="redirectToOrderUpdate('${
                  order._id
                }')">
                  <i class="fas fa-eye"></i> View
                
              </div>
            </td>
          </tr>
        `;
          tableBody.innerHTML += orderRow;
        });
      }

      // Setup pagination
      function setupPagination(pagination) {
        const paginationContainer = document.getElementById(
          "pagination-container"
        );
        if (!paginationContainer) return;

        paginationContainer.innerHTML = "";

        // Previous button
        const prevLi = document.createElement("li");
        prevLi.className = `page-item ${
          !pagination.hasPrevPage ? "disabled" : ""
        }`;
        prevLi.innerHTML = `<a class="page-link" href="#" ${
          pagination.hasPrevPage
            ? 'onclick="loadOrders(' + (currentPage - 1) + ', \'' + currentStatus + '\')"'
            : ""
        }>Previous</a>`;
        paginationContainer.appendChild(prevLi);

        // Page numbers
        const totalPages = pagination.totalPages || 1;
        for (let i = 1; i <= totalPages; i++) {
          const pageLi = document.createElement("li");
          pageLi.className = `page-item ${i === currentPage ? "active" : ""}`;
          pageLi.innerHTML = `<a class="page-link" href="#" onclick="loadOrders(${i}, '${currentStatus}')">${i}</a>`;
          paginationContainer.appendChild(pageLi);
        }

        // Next button
        const nextLi = document.createElement("li");
        nextLi.className = `page-item ${
          !pagination.hasNextPage ? "disabled" : ""
        }`;
        nextLi.innerHTML = `<a class="page-link" href="#" ${
          pagination.hasNextPage
            ? 'onclick="loadOrders(' + (currentPage + 1) + ', \'' + currentStatus + '\')"'
            : ""
        }>Next</a>`;
        paginationContainer.appendChild(nextLi);
      }

      // Redirect to order update page
      function redirectToOrderUpdate(orderId) {
        try {
          console.log("Redirecting to order update page for order:", orderId);
          
          // Store the order ID to use on the next page
          localStorage.setItem('selectedOrderId', orderId);
          
          // Redirect to the order update page with order ID in URL
          window.location.href = `adminOrder-update.html?orderId=${orderId}`;
          
        } catch (error) {
          console.error("Error redirecting to order update page:", error);
          notyf.error("Error redirecting to order page. Please try again.");
        }
      }

      // Logout function
      function logout() {
        localStorage.removeItem("adminToken");
        localStorage.removeItem("adminLoggedIn");
        localStorage.removeItem("adminId");
        localStorage.removeItem("adminName");
        window.location.href = "admin-login.html";
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        // Add logout event listeners
        const logoutBtn = document.getElementById("logoutBtn");
        const logoutBtnHeader = document.getElementById("logoutBtnHeader");

        if (logoutBtn) {
          logoutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            logout();
          });
        }
        if (logoutBtnHeader) {
          logoutBtnHeader.addEventListener("click", function (e) {
            e.preventDefault();
            logout();
          });
        }

        // Display admin name if available
        const adminName = localStorage.getItem("adminName");
        if (adminName) {
          const adminNameElement = document.getElementById("adminNameDisplay");
          if (adminNameElement) {
            adminNameElement.textContent = adminName;
          }
        }

        // Setup status filter button listeners
        const statusButtons = document.querySelectorAll(".status-filter-btn");
        statusButtons.forEach(button => {
          button.addEventListener("click", function() {
            const status = this.getAttribute("data-status");
            loadOrders(1, status);
          });
        });

        // // Close modal button for status update modal
        // const closeStatusModal = document.getElementById("closeStatusModal");
        // if (closeStatusModal) {
        //   closeStatusModal.addEventListener("click", function () {
        //     closeModal("statusUpdateModal");
        //   });
        // }

        // // Close modal when clicking outside
        // window.addEventListener("click", function (event) {
        //   const modal = document.getElementById("statusUpdateModal");
        //   if (event.target === modal) {
        //     modal.style.display = "none";
        //   }
        // });

        // Load all orders initially
        loadOrders(1, "all");
      });
    </script>
  </body>
</html>