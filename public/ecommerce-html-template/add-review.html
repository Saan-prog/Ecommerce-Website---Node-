<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Add Review - ShopStyle</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400|Source+Code+Pro:700,900&display=swap"
        rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <style>
        /* Add Review Page Styles */
        .add-review-page {
            padding: 40px 0;
            min-height: 70vh;
            background-color: #f8f9fa;
        }

        .review-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .review-header {
            background: linear-gradient(135deg, #d899bc 0%, #FF6B6B 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .review-header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .review-header p {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .review-content {
            padding: 40px;
        }

        /* Product Info Card */
        .product-info-card {
            display: flex;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #eaeaea;
        }

        .product-image-container {
            width: 120px;
            height: 120px;
            flex-shrink: 0;
            margin-right: 25px;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .product-details h3 {
            color: #2c3e50;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .product-meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .order-info {
            color: #888;
            font-size: 13px;
            margin-top: 5px;
        }

        /* Review Form */
        .rating-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            color: #FF9F00;
        }

        /* Star Rating */
        .star-rating-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .star-rating {
            display: flex;
            flex-direction: row-reverse;
            gap: 5px;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            font-size: 36px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }

        .star-rating label:hover,
        .star-rating label:hover~label,
        .star-rating input:checked~label {
            color: #FFC107;
        }

        .rating-text {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }

        .rating-label {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 13px;
            color: #888;
        }

        /* Review Input */
        .review-input-section {
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: block;
        }

        .form-control {
            border: 2px solid #eaeaea;
            border-radius: 8px;
            padding: 15px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #FF9F00;
            box-shadow: 0 0 0 0.2rem rgba(255, 159, 0, 0.25);
        }

        .char-count {
            text-align: right;
            font-size: 13px;
            color: #888;
            margin-top: 5px;
        }

        .char-count.warning {
            color: #ff6b6b;
        }

        /* Review Tips */
        .review-tips {
            background: #f0f9ff;
            border-left: 4px solid #4dabf7;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 30px;
        }

        .review-tips h6 {
            color: #1864ab;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .review-tips h6 i {
            margin-right: 8px;
        }

        .review-tips ul {
            padding-left: 20px;
            margin-bottom: 0;
        }

        .review-tips li {
            color: #495057;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .review-tips li:last-child {
            margin-bottom: 0;
        }

        /* Photo Upload */
        .photo-upload-section {
            margin-bottom: 40px;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-area:hover {
            border-color: #FF9F00;
            background: #fff9e6;
        }

        .upload-area.drag-over {
            border-color: #FF9F00;
            background: #fff9e6;
        }

        .upload-icon {
            font-size: 48px;
            color: #FF9F00;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #666;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .upload-subtext {
            color: #888;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .upload-btn {
            background: #FF9F00;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }

        .upload-btn:hover {
            background: #e68a00;
        }

        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .preview-image {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 6px;
            overflow: hidden;
        }

        .preview-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #eaeaea;
        }

        .btn-secondary {
            background: #6c757d;
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #5a6268;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF9F00 0%, #FF6B6B 100%);
            border: none;
            color: white;
            padding: 12px 40px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 159, 0, 0.3);
            color: white;
        }

        /* Error Messages */
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #991b1b;
        }

        .error-message i {
            font-size: 20px;
        }

        /* Success Modal */
        .success-modal-content {
            text-align: center;
            padding: 40px 30px;
        }

        .success-icon {
            font-size: 60px;
            color: #28a745;
            margin-bottom: 20px;
        }

        .success-title {
            color: #28a745;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .success-message {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }

        /* Order ID Input Section */
        .order-id-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #eaeaea;
        }

        .order-id-input-group {
            max-width: 400px;
        }

        .order-id-hint {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
            display: flex;
            align-items: center;
        }

        .order-id-hint i {
            color: #FF9F00;
            margin-right: 8px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FF9F00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .review-content {
                padding: 25px;
            }

            .product-info-card {
                flex-direction: column;
                text-align: center;
            }

            .product-image-container {
                margin-right: 0;
                margin-bottom: 20px;
            }

            .star-rating label {
                font-size: 32px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-secondary,
            .btn-primary {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Top bar Start -->
    <div class="top-bar">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <i class="fa fa-envelope"></i>
                    support@shopstyle.com
                </div>
                <div class="col-sm-6">
                    <i class="fa fa-phone-alt"></i>
                    +91-98765-43210
                </div>
            </div>
        </div>
    </div>
    <!-- Top bar End -->

    <!-- Nav Bar Start -->
    <div class="nav">
        <div class="container-fluid">
            <nav class="navbar navbar-expand-md navbar-dark bg-dark">
                <a href="#" class="navbar-brand">MENU</a>
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                    <div class="navbar-nav me-auto">
                        <a href="index.html" class="nav-item nav-link">Home</a>
                        <a href="product-list.html" class="nav-item nav-link">Products</a>
                        <a href="cart.html" class="nav-item nav-link">Cart</a>
                        <a href="wishlist.html" class="nav-item nav-link">Wishlist</a>
                        <a href="checkout.html" class="nav-item nav-link">Checkout</a>
                        <a href="order-history.html" class="nav-item nav-link">My Orders</a>
                    </div>
                    <div class="navbar-nav ms-auto align-items-center">
                        <div class="nav-item dropdown user-account" id="userAccountDropdown" style="display: none;">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="fa fa-user-circle"></i> My Account
                            </a>
                            <div class="dropdown-menu dropdown-menu-end">
                                <a href="my-account.html" class="dropdown-item">Dashboard</a>
                                <a href="#" class="dropdown-item" id="logoutBtn"><i class="fas fa-sign-out-alt"></i>
                                    Logout</a>
                            </div>
                        </div>

                        <div class="nav-item dropdown" id="loginDropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Login</a>
                            <div class="dropdown-menu dropdown-menu-end">
                                <a href="login.html" class="dropdown-item">Login</a>
                                <a href="register.html" class="dropdown-item">Register</a>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <!-- Nav Bar End -->

    <!-- Bottom Bar Start -->
    <div class="bottom-bar">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="logo">
                        <a href="index.html">
                            <img src="img/logo.png" alt="ShopStyle Logo">
                        </a>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="search">
                        <input type="text" placeholder="Search for products...">
                        <button><i class="fa fa-search"></i></button>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="user">
                        <a href="wishlist.html" class="btn wishlist">
                            <i class="fa fa-heart"></i>
                            <span>(0)</span>
                        </a>
                        <a href="cart.html" class="btn cart">
                            <i class="fa fa-shopping-cart"></i>
                            <span>(0)</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Bottom Bar End -->

    <!-- Breadcrumb Start -->
    <div class="breadcrumb-wrap">
        <div class="container-fluid">
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item"><a href="order-history.html">My Orders</a></li>
                <li class="breadcrumb-item active">Add Review</li>
            </ul>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Add Review Page Content -->
    <div class="add-review-page">
        <div class="container-fluid">
            <div class="review-container">
                <!-- Review Header -->
                <div class="review-header">
                    <h1><i class="fas fa-star me-2"></i>Write a Review</h1>
                    <p>Share your experience to help other shoppers</p>
                </div>

                <!-- Review Content -->
                <div class="review-content">
                    <!-- Error Message Container -->
                    <div id="errorMessage" style="display: none;"></div>

                    <!-- Product Information -->
                    <div class="product-info-card">
                        <div class="product-image-container">
                            <img id="productImage" src="img/product-placeholder.png" alt="Product" class="product-image">
                        </div>
                        <div class="product-details">
                            <h3 id="productName">Product Name</h3>
                            <div class="product-meta">
                                <span id="productCategory">Category: Clothing</span> •
                                <span id="productPrice">Price: ₹0.00</span>
                            </div>
                            <div class="product-description" id="productDescription"></div>
                        </div>
                    </div>

                    <!-- Order ID Input Section -->
                    <div class="order-id-section">
                        <h3 class="section-title"><i class="fas fa-receipt"></i> Order Information</h3>
                        <div class="form-group">
                            <label class="form-label" for="orderIdInput">Order ID *</label>
                            <div class="order-id-input-group">
                                <input type="text" class="form-control" id="orderIdInput"
                                    placeholder="Enter your Order ID (e.g., ORD-123456)" required>
                            </div>
                            <div class="order-id-hint">
                                <i class="fas fa-info-circle"></i>
                                You can find your Order ID in your Orders page or order confirmation email
                            </div>
                        </div>
                    </div>

                    <!-- Rating Section -->
                    <div class="rating-section">
                        <h3 class="section-title"><i class="fas fa-star"></i> Overall Rating</h3>
                        <div class="star-rating-container">
                            <div class="star-rating">
                                <input type="radio" id="star5" name="rating" value="5">
                                <label for="star5" title="5 stars"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star4" name="rating" value="4">
                                <label for="star4" title="4 stars"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star3" name="rating" value="3">
                                <label for="star3" title="3 stars"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star2" name="rating" value="2">
                                <label for="star2" title="2 stars"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star1" name="rating" value="1">
                                <label for="star1" title="1 star"><i class="fas fa-star"></i></label>
                            </div>
                            <div class="rating-text" id="ratingText">Select your rating</div>
                        </div>
                        <div class="rating-label">
                            <span>Poor</span>
                            <span>Fair</span>
                            <span>Average</span>
                            <span>Good</span>
                            <span>Excellent</span>
                        </div>
                    </div>

                    <!-- Review Input Section -->
                    <div class="review-input-section">
                        <h3 class="section-title"><i class="fas fa-edit"></i> Write Your Review</h3>

                        <!-- Review Title -->
                        <div class="form-group">
                            <label class="form-label" for="reviewTitle">Review Title *</label>
                            <input type="text" class="form-control" id="reviewTitle"
                                placeholder="Summarize your experience in a few words" maxlength="100" required>
                            <div class="char-count">0/100 characters</div>
                        </div>

                        <!-- Detailed Review -->
                        <div class="form-group">
                            <label class="form-label" for="reviewText">Detailed Review *</label>
                            <textarea class="form-control" id="reviewText" rows="6"
                                placeholder="Tell us more about your experience with this product. What did you like or dislike? How does it fit? Is it worth the price?"
                                maxlength="1000" required></textarea>
                            <div class="char-count">0/1000 characters</div>
                        </div>

                        <!-- Review Tips -->
                        <div class="review-tips">
                            <h6><i class="fas fa-lightbulb"></i> Writing a helpful review:</h6>
                            <ul>
                                <li>Describe the product quality and features</li>
                                <li>Mention how it fits (if it's clothing)</li>
                                <li>Compare with your expectations</li>
                                <li>Share pros and cons honestly</li>
                                <li>Avoid personal information</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Photo Upload Section -->
                    <div class="photo-upload-section">
                        <h3 class="section-title"><i class="fas fa-camera"></i> Add Photos (Optional)</h3>
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">Drag & drop photos here</div>
                            <div class="upload-subtext">or click to browse</div>
                            <button type="button" class="upload-btn" onclick="document.getElementById('fileInput').click()">
                                Choose Files
                            </button>
                            <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
                        </div>
                        <div class="preview-container" id="previewContainer">
                            <!-- Photo previews will be added here -->
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">
                            <i class="fas fa-times me-2"></i> Cancel
                        </button>
                        <button type="button" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-paper-plane me-2"></i> Submit Review
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay (Hidden by default) -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <h3>Loading...</h3>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="success-modal-content">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2 class="success-title">Review Submitted Successfully!</h2>
                    <p class="success-message" id="successMessage">Thank you for sharing your experience. Your review helps other shoppers make better decisions.</p>
                    <div class="mt-4">
                        <button type="button" class="btn btn-primary" id="backToOrdersBtn" style="padding: 10px 30px;">
                            <i class="fas fa-arrow-left me-2"></i> Back to My Orders
                        </button>
                        <button type="button" class="btn btn-secondary" id="viewProductBtn" style="padding: 10px 30px; margin-left: 10px;">
                            <i class="fas fa-eye me-2"></i> View Product
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Start -->
    <div class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h2>Get in Touch</h2>
                        <div class="contact-info">
                            <p><i class="fa fa-map-marker"></i>123 Fashion Street, Mumbai, India</p>
                            <p><i class="fa fa-envelope"></i>support@shopstyle.com</p>
                            <p><i class="fa fa-phone"></i>+91-98765-43210</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h2>Follow Us</h2>
                        <div class="contact-info">
                            <div class="social">
                                <a href=""><i class="fab fa-twitter"></i></a>
                                <a href=""><i class="fab fa-facebook-f"></i></a>
                                <a href=""><i class="fab fa-linkedin-in"></i></a>
                                <a href=""><i class="fab fa-instagram"></i></a>
                                <a href=""><i class="fab fa-youtube"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h2>Company Info</h2>
                        <ul>
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms & Condition</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h2>Purchase Info</h2>
                        <ul>
                            <li><a href="#">Payment Policy</a></li>
                            <li><a href="#">Shipping Policy</a></li>
                            <li><a href="#">Return Policy</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="row payment align-items-center">
                <div class="col-md-6">
                    <div class="payment-method">
                        <h2>We Accept:</h2>
                        <img src="img/payment-method.png" alt="Payment Methods" />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="payment-security">
                        <h2>Secured By:</h2>
                        <img src="img/godaddy.svg" alt="GoDaddy Security" />
                        <img src="img/norton.svg" alt="Norton Security" />
                        <img src="img/ssl.svg" alt="SSL Security" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Footer Bottom Start -->
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-md-6 copyright">
                    <p>Copyright &copy; <a href="#">ShopStyle</a>. All Rights Reserved</p>
                </div>

                <div class="col-md-6 template-by">
                    <p>Designed By <a href="https://htmlcodex.com">HTML Codex</a></p>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer Bottom End -->

    <!-- Back to Top -->
    <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

    <!-- Bootstrap 5 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <script>
        const notyf = new Notyf({
            duration: 3000,
            position: {
                x: 'right',
                y: 'top',
            },
            types: [
                {
                    type: 'success',
                    background: '#28a745',
                    icon: {
                        className: 'fas fa-check-circle',
                        tagName: 'i',
                        color: '#fff'
                    }
                },
                {
                    type: 'error',
                    background: '#dc3545',
                    icon: {
                        className: 'fas fa-exclamation-circle',
                        tagName: 'i',
                        color: '#fff'
                    }
                },
                {
                    type: 'warning',
                    background: '#ffc107',
                    icon: {
                        className: 'fas fa-exclamation-triangle',
                        tagName: 'i',
                        color: '#fff'
                    }
                },
                {
                    type: 'info',
                    background: '#17a2b8',
                    icon: {
                        className: 'fas fa-info-circle',
                        tagName: 'i',
                        color: '#fff'
                    }
                }
            ]
        });

        // Global variables
        let productDetails = null;
        let currentProductId = null;
        let successModal = null;

        // When page loads
        document.addEventListener("DOMContentLoaded", function () {
            // 1. Check if user is logged in
            const token = localStorage.getItem("token");

            if (!token) {
                // If not logged in, redirect to login page
                notyf.error("Session expired. Please login again.");
                setTimeout(() => {
                    window.location.href = "admin-login.html";
                }, 1500);
                return;
            }

            // 2. Show user dropdown
            const loginDropdown = document.getElementById("loginDropdown");
            const userAccountDropdown = document.getElementById("userAccountDropdown");

            if (loginDropdown) loginDropdown.style.display = "none";
            if (userAccountDropdown) userAccountDropdown.style.display = "block";

            // 3. Get URL parameters - NOW ONLY PRODUCT ID
            const urlParams = new URLSearchParams(window.location.search);
            currentProductId = urlParams.get('productId');

            if (!currentProductId) {
                showErrorMessage("No product selected. Please go back to your orders and try again.");
                setTimeout(() => {
                    window.location.href = "order-history.html";
                }, 2000);
                return;
            }

            // 4. Initialize Bootstrap modal
            const modalElement = document.getElementById('successModal');
            if (modalElement) {
                successModal = new bootstrap.Modal(modalElement);
            }

            // 5. Fetch product details
            showLoading("Loading product details...");
            fetchProductDetails(currentProductId, token)
                .then(() => {
                    hideLoading();
                    updateProductInfo();
                    initializeEventListeners();
                })
                .catch(error => {
                    hideLoading();
                    console.error("Error loading product details:", error);
                    showErrorMessage("Failed to load product details. Please try again.");
                    // Still allow user to proceed with manual order ID entry
                    initializeEventListeners();
                });

            // 6. Setup logout button
            const logoutBtn = document.getElementById("logoutBtn");
            if (logoutBtn) {
                logoutBtn.addEventListener("click", function (e) {
                    e.preventDefault();
                    localStorage.removeItem("token");
                    notyf.success("You have been logged out successfully.");
                    window.location.href = "index.html";
                });
            }
        });

        // Function to show loading
        function showLoading(message = "Loading...") {
            const overlay = document.getElementById('loadingOverlay');
            if (message) overlay.querySelector('h3').textContent = message;
            overlay.style.display = 'flex';
        }

        // Function to hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Function to fetch product details
        async function fetchProductDetails(productId, token) {
            try {
                // Fetch product details from your API
                const response = await fetch(`http://localhost:8070/api/products/${productId}`, {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Handle both response formats:
                    // 1. { success: true, product: {...} }
                    // 2. Direct product object
                    if (data.success && data.product) {
                        productDetails = data.product;
                    } else if (data._id || data.id) {
                        productDetails = data; // Direct product object
                    } else {
                        throw new Error(data.message || "Failed to fetch product details");
                    }
                } else {
                    throw new Error("Product not found");
                }
            } catch (error) {
                console.error("Error fetching product details:", error);
                throw error;
            }
        }

        // Update product information in UI
        function updateProductInfo() {
            if (!productDetails) {
                showErrorMessage("Product information not available");
                return;
            }

            const productName = document.getElementById('productName');
            const productImage = document.getElementById('productImage');
            const productCategory = document.getElementById('productCategory');
            const productPrice = document.getElementById('productPrice');
            const productDescription = document.getElementById('productDescription');

            // Product name
            productName.textContent = productDetails.name || 'Product';
            
            // Product image - handle both array and string formats
            if (productDetails.images && productDetails.images.length > 0) {
                productImage.src = Array.isArray(productDetails.images) 
                    ? productDetails.images[0] 
                    : productDetails.images;
            } else if (productDetails.image) {
                productImage.src = Array.isArray(productDetails.image) 
                    ? productDetails.image[0] 
                    : productDetails.image;
            }
            
            // Set default image on error
            productImage.onerror = function() {
                this.src = "img/product-placeholder.png";
            };
            
            // Product category
            if (productDetails.category) {
                productCategory.textContent = `Category: ${productDetails.category}`;
            } else {
                productCategory.style.display = 'none';
            }
            
            // Product price
            if (productDetails.price) {
                productPrice.textContent = `Price: ₹${productDetails.price.toLocaleString('en-IN')}`;
            } else {
                productPrice.style.display = 'none';
            }
            
            // Product description
            if (productDetails.description) {
                productDescription.textContent = productDetails.description;
                productDescription.style.display = 'block';
            } else {
                productDescription.style.display = 'none';
            }
        }

        // Show error message
        function showErrorMessage(message) {
            const errorContainer = document.getElementById('errorMessage');
            errorContainer.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>${message}</span>
                </div>
            `;
            errorContainer.style.display = 'block';
        }

        // Hide error message
        function hideErrorMessage() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Star rating hover effect
            const stars = document.querySelectorAll('.star-rating label');
            const ratingText = document.getElementById('ratingText');
            const ratingDescriptions = {
                1: "Poor - Very disappointed",
                2: "Fair - Could be better",
                3: "Average - Met expectations",
                4: "Good - Happy with purchase",
                5: "Excellent - Exceeded expectations"
            };

            stars.forEach(star => {
                star.addEventListener('mouseenter', function () {
                    const ratingValue = this.previousElementSibling.value;
                    ratingText.textContent = ratingDescriptions[ratingValue] || "Select your rating";
                });

                star.addEventListener('mouseleave', function () {
                    const checkedStar = document.querySelector('.star-rating input:checked');
                    if (checkedStar) {
                        ratingText.textContent = ratingDescriptions[checkedStar.value];
                    } else {
                        ratingText.textContent = "Select your rating";
                    }
                });
            });

            // Star rating selection
            document.querySelectorAll('.star-rating input').forEach(input => {
                input.addEventListener('change', function () {
                    ratingText.textContent = ratingDescriptions[this.value];
                });
            });

            // Character count for review title
            const reviewTitle = document.getElementById('reviewTitle');
            const titleCharCount = reviewTitle.nextElementSibling;

            reviewTitle.addEventListener('input', function () {
                const length = this.value.length;
                titleCharCount.textContent = `${length}/100 characters`;
                if (length > 90) {
                    titleCharCount.classList.add('warning');
                } else {
                    titleCharCount.classList.remove('warning');
                }
            });

            // Character count for review text
            const reviewText = document.getElementById('reviewText');
            const textCharCount = reviewText.nextElementSibling;

            reviewText.addEventListener('input', function () {
                const length = this.value.length;
                textCharCount.textContent = `${length}/1000 characters`;
                if (length > 900) {
                    textCharCount.classList.add('warning');
                } else {
                    textCharCount.classList.remove('warning');
                }
            });

            // File upload functionality
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const previewContainer = document.getElementById('previewContainer');

            // Drag and drop events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                uploadArea.classList.add('drag-over');
            }

            function unhighlight() {
                uploadArea.classList.remove('drag-over');
            }

            // Handle file drop
            uploadArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            // Handle file selection
            fileInput.addEventListener('change', function () {
                handleFiles(this.files);
            });

            function handleFiles(files) {
                [...files].forEach(previewFile);
            }

            function previewFile(file) {
                if (!file.type.match('image.*')) {
                    notyf.warning('Please upload only image files.');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    notyf.warning('File size should be less than 5MB.');
                    return;
                }

                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onloadend = function () {
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'preview-image';
                    previewDiv.innerHTML = `
                        <img src="${reader.result}" alt="Preview">
                        <button type="button" class="remove-image" onclick="this.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    previewContainer.appendChild(previewDiv);
                };
            }

            // Cancel button
            document.getElementById('cancelBtn').addEventListener('click', function () {
                if (confirm('Are you sure you want to cancel? Your review will not be saved.')) {
                    window.location.href = 'order-history.html';
                }
            });

            // Submit button
            document.getElementById('submitBtn').addEventListener('click', submitReview);

            // Success modal buttons
            document.getElementById('backToOrdersBtn').addEventListener('click', function () {
                window.location.href = 'order-history.html';
            });

            document.getElementById('viewProductBtn').addEventListener('click', function () {
                window.location.href = `product-detail.html?id=${currentProductId}`;
            });
        }

        // Submit review function
        async function submitReview() {
            // Hide any previous error messages
            hideErrorMessage();

            // Validate order ID
            const orderId = document.getElementById('orderIdInput').value.trim();
            if (!orderId) {
                showErrorMessage('Please enter your Order ID.');
                document.getElementById('orderIdInput').focus();
                return;
            }

            // Validate rating
            const ratingInput = document.querySelector('.star-rating input:checked');
            if (!ratingInput) {
                showErrorMessage('Please select a rating before submitting.');
                return;
            }

            // Validate review title
            const reviewTitle = document.getElementById('reviewTitle').value.trim();
            if (!reviewTitle) {
                showErrorMessage('Please enter a review title.');
                document.getElementById('reviewTitle').focus();
                return;
            }

            // Validate review text
            const reviewText = document.getElementById('reviewText').value.trim();
            if (!reviewText) {
                showErrorMessage('Please write a detailed review.');
                document.getElementById('reviewText').focus();
                return;
            }

            if (reviewText.length < 10) {
                showErrorMessage('Please write a more detailed review (at least 10 characters).');
                document.getElementById('reviewText').focus();
                return;
            }

            // Prepare review data
            const reviewData = {
                productId: currentProductId,
                orderId: orderId,
                rating: parseInt(ratingInput.value),
                comment: reviewText,
                title: reviewTitle
            };

            // Show loading
            showLoading("Submitting your review...");

            try {
                const token = localStorage.getItem("token");
                if (!token) {
                    throw new Error("Session expired. Please login again.");
                }
                
                // Submit review to backend API
                const response = await fetch('http://localhost:8070/api/user/cart/order/reviews/add', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reviewData)
                });

                const result = await response.json();

                // Hide loading
                hideLoading();

                if (response.ok && result.success) {
                    // Get product name for success message
                    const productName = productDetails?.name || 'Product';
                    
                    // Save to localStorage as backup and for order history page
                    const existingReviews = JSON.parse(localStorage.getItem('userReviews') || '[]');
                    existingReviews.push({
                        ...reviewData,
                        productName: productName,
                        reviewDate: new Date().toISOString()
                    });
                    localStorage.setItem('userReviews', JSON.stringify(existingReviews));
                    
                    // Set success message in localStorage for order history page
                    localStorage.setItem('reviewSuccess', 'true');
                    localStorage.setItem('reviewedProduct', productName);
                    
                    // Show success modal
                    document.getElementById('successMessage').textContent = 
                        `Thank you for reviewing "${productName}"! Your feedback helps other shoppers.`;
                    
                    // Show modal using Bootstrap 5
                    if (successModal) {
                        successModal.show();
                    }
                    
                } else {
                    // Handle API error
                    showErrorMessage(result.message || 'Failed to submit review. Please try again.');
                }
                
            } catch (error) {
                console.error('Error submitting review:', error);
                hideLoading();
                showErrorMessage('Failed to submit review. Please try again.');
            }
        }

        // Function to remove uploaded image
        window.removeImage = function (button) {
            button.parentElement.remove();
        };
    </script>
</body>

</html>