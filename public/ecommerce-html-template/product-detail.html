<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ShopStyle - Product Details</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta content="Modern eCommerce HTML Template" name="keywords" />
  <meta content="Contemporary eCommerce Template" name="description" />

  <!-- Favicon -->
  <link href="img/favicon.ico" rel="icon" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- CSS Libraries -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
  <link href="lib/slick/slick.css" rel="stylesheet" />
  <link href="lib/slick/slick-theme.css" rel="stylesheet" />

  <!-- Template Stylesheet -->
  <link href="css/style.css" rel="stylesheet" />
  
  <style>
    /* Additional styles for product detail page */
    .product-detail-content {
      transition: opacity 0.3s ease;
    }

    /* Product Image Gallery with Zoom Styles - IMPROVED */
    .product-image-section {
      position: relative;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      border: 1px solid var(--light-gray);
      overflow: hidden;
      height: auto;
    }

    .product-slider-single {
      position: relative;
      margin-bottom: 10px;
    }

    /* Zoom Container Styles */
    .zoom-container {
      position: relative;
      overflow: hidden;
      height: 350px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8f9fa;
      border-radius: 8px;
      cursor: crosshair;
    }

    /* Main product image */
    #mainProductImage {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
}

    /* Zoom lens (the small circle that follows cursor) */
   .zoom-lens {
    position: absolute;
    border: 2px solid var(--accent);
    border-radius: 4px; /* Changed from circle to square for better accuracy */
    background: rgba(52, 152, 219, 0.3);
    pointer-events: none;
    z-index: 5;
    display: none;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    width: 100px;
    height: 100px;
    transition: width 0.2s, height 0.2s;
}

    /* Zoom result container (shows zoomed image) */
   .zoom-result {
    position: absolute;
    width: 200px;
    height: 200px;
    border: 2px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    background: white;
    box-shadow: 0 0 25px rgba(0, 0, 0, 0.2);
    display: none;
    z-index: 100;
    pointer-events: none;
}

   .zoom-result img {
    position: absolute;
    top: 0;
    left: 0;
    transition: transform 0.05s ease-out;
    max-width: none;
    max-height: none;
}

    /* Slider navigation buttons */
    .slider-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .slider-btn:hover {
      background: rgba(0, 0, 0, 0.8);
    }

    .slider-prev {
      left: 15px;
    }

    .slider-next {
      right: 15px;
    }

    /* Thumbnails */
    .product-thumbnails {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 15px;
      padding: 0 10px 15px;
    }

    .thumbnail-item {
      cursor: pointer;
      border: 2px solid transparent;
      padding: 3px;
      border-radius: 4px;
      width: 70px;
      height: 70px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      background: white;
    }

    .thumbnail-item:hover {
      border-color: var(--light-gray);
    }

    .thumbnail-item.active {
      border-color: var(--accent);
    }

    .thumbnail-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Zoom controls */
    .zoom-controls {
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 5;
      display: flex;
      gap: 5px;
    }

    .zoom-container {
    position: relative;
    overflow: hidden;
    height: 250px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    border-radius: 8px;
    cursor: crosshair;
}

    .zoom-btn {
      width: 32px;
      height: 32px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
    }

    .zoom-btn:hover {
      background: #f8f9fa;
      border-color: var(--accent);
    }

    /* Product Details Section - IMPROVED LAYOUT */
    .product-detail-info {
      background: white;
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--light-gray);
      margin-bottom: 20px;
      height: auto;
      min-height: 0;
    }

    .product-content .title h2 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--dark);
      line-height: 1.3;
    }

    /* Product description under title - NEW */
    .product-short-description {
      color: var(--secondary);
      font-size: 14px;
      margin-bottom: 15px;
      line-height: 1.5;
      max-height: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .product-content .price p {
      font-size: 26px;
      color: var(--danger);
      font-weight: bold;
      margin: 12px 0;
    }

    /* Quantity Section */
    .quantity {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 18px;
    }

    .quantity h4 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      min-width: 70px;
    }

    .quantity .qty {
      display: flex;
      align-items: center;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .quantity .btn-minus,
    .quantity .btn-plus {
      width: 36px;
      height: 36px;
      border: none;
      background: var(--light);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .quantity .btn-minus:hover,
    .quantity .btn-plus:hover {
      background: var(--light-gray);
    }

    .quantity #quantity-input {
      width: 50px;
      height: 36px;
      border: none;
      border-left: 1px solid var(--light-gray);
      border-right: 1px solid var(--light-gray);
      text-align: center;
      font-weight: 600;
      font-size: 15px;
      color: var(--dark);
    }

    /* Size buttons */
    .p-size {
      margin-bottom: 20px;
    }

    .p-size h4 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .p-size .btn-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .p-size .btn-group .btn {
      min-width: 45px;
      padding: 7px 12px;
      border: 1px solid var(--light-gray);
      background: white;
      color: var(--dark);
      transition: var(--transition);
      font-size: 14px;
    }

    .p-size .btn-group .btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .p-size .btn-group .btn:hover:not(.active) {
      border-color: var(--primary);
      color: var(--primary);
    }

    /* Action buttons */
    .action {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--light-gray);
    }

    .action .btn {
      flex: 1;
      padding: 10px 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 14px;
    }

    .action .btn i {
      font-size: 15px;
    }

    /* Product Tabs - Only Description and Reviews */
    .product-tabs {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--light-gray);
      overflow: hidden;
      margin-top: 25px;
    }

    .product-tabs .nav-pills {
      background: var(--light);
      border-bottom: 1px solid var(--light-gray);
      display: flex;
      flex-wrap: wrap;
    }

    .product-tabs .nav-pills .nav-link {
      padding: 12px 20px;
      color: var(--dark);
      font-weight: 500;
      border-radius: 0;
      transition: var(--transition);
      flex: 1;
      text-align: center;
      font-size: 14px;
      min-width: 140px;
    }

    .product-tabs .nav-pills .nav-link.active {
      background: var(--primary);
      color: white;
    }

    .product-tabs .nav-pills .nav-link:hover:not(.active) {
      color: var(--primary);
      background: rgba(44, 62, 80, 0.05);
    }

    .tab-content {
      padding: 25px;
    }

    .tab-content h4 {
      color: var(--primary);
      margin-bottom: 15px;
      font-weight: 600;
      font-size: 18px;
    }

    /* Reviews styling */
    .reviews-container {
      max-height: 350px;
      overflow-y: auto;
      padding-right: 10px;
    }
    
    .review-item {
      border-bottom: 1px solid var(--light-gray);
      padding: 15px 0;
    }
    
    .review-item:last-child {
      border-bottom: none;
    }
    
    .review-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 10px;
    }
    
    .reviewer-name {
      font-weight: 600;
      color: var(--dark);
      font-size: 15px;
    }
    
    .review-date {
      color: var(--secondary);
      font-size: 13px;
    }
    
    .no-reviews {
      text-align: center;
      padding: 30px 0;
      color: var(--secondary);
    }
    
    .no-reviews i {
      font-size: 40px;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    /* Loading and Error States */
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 300px;
      flex-direction: column;
    }
    
    .error-message {
      color: var(--danger);
      text-align: center;
      padding: 40px 20px;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    /* Rating stars */
    .ratting {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 12px;
    }

    .ratting i {
      color: #fbbf24;
      font-size: 15px;
    }

    .rating-text {
      color: var(--secondary);
      font-size: 13px;
      margin-left: 6px;
    }

    /* Sidebar adjustments */
    .sidebar {
      margin-top: 0;
    }

    .category-sidebar-container {
      margin-bottom: 25px;
    }

    .sidebar-widget {
      margin-bottom: 25px;
    }

    /* RESPONSIVE DESIGN - IMPROVED */
    @media (max-width: 1200px) {
      .zoom-container {
        height: 320px;
      }
    }

    @media (max-width: 992px) {
      .zoom-result {
        display: none !important;
      }
      
      .zoom-lens {
        display: none !important;
      }
      
      .zoom-container {
        cursor: default;
        height: 100px;
        max-height: 100px;
      }
      
      .action {
        flex-direction: row;
      }
      
      .product-content .title h2 {
        font-size: 22px;
      }
      
      .product-image-section {
        margin-bottom: 20px;
      }
      
      .product-detail-info {
        margin-bottom: 20px;
      }
      
      .zoom-controls {
        display: none !important;
      }
    }

    @media (max-width: 768px) {
      .product-content .title h2 {
        font-size: 20px;
      }
      
      .product-short-description {
        font-size: 13px;
        margin-bottom: 12px;
      }
      
      .product-content .price p {
        font-size: 22px;
      }
      
      .zoom-container {
        height: 280px;
      }
      
      .thumbnail-item {
        width: 60px;
        height: 60px;
      }
      
      .action {
        flex-direction: column;
      }
      
      .action .btn {
        width: 100%;
      }
      
      .product-tabs .nav-pills .nav-link {
        min-width: 120px;
        padding: 10px 15px;
      }
      
      .tab-content {
        padding: 20px 15px;
      }
    }

    @media (max-width: 576px) {
      .product-content .title h2 {
        font-size: 18px;
      }
      
      .product-short-description {
        -webkit-line-clamp: 3;
        max-height: 70px;
      }
      
      .zoom-container {
        height: 250px;
      }
      
      .thumbnail-item {
        width: 50px;
        height: 50px;
      }
      
      .product-detail-info {
        padding: 20px;
      }
      
      .quantity {
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .quantity h4 {
        min-width: 100%;
        margin-bottom: 5px;
      }
      
      .p-size h4 {
        margin-bottom: 8px;
      }
      
      .p-size .btn-group .btn {
        min-width: 40px;
        padding: 6px 10px;
        font-size: 13px;
      }
      
      .product-tabs .nav-pills {
        flex-direction: column;
      }
      
      .product-tabs .nav-pills .nav-link {
        min-width: 100%;
        text-align: left;
        border-bottom: 1px solid var(--light-gray);
      }
      
      .product-tabs .nav-pills .nav-link:last-child {
        border-bottom: none;
      }
    }

    @media (max-width: 480px) {
      .zoom-container {
        height: 220px;
      }
      
      .product-content .title h2 {
        font-size: 17px;
      }
      
      .product-content .price p {
        font-size: 20px;
      }
      
      .thumbnail-item {
        width: 45px;
        height: 45px;
      }
      
      .action .btn {
        padding: 8px 12px;
        font-size: 13px;
      }
    }

    /* Utility classes for better spacing */
    .mb-15 {
      margin-bottom: 15px !important;
    }
    
    .mb-10 {
      margin-bottom: 10px !important;
    }
    
    .mb-5 {
      margin-bottom: 5px !important;
    }
  </style>
</head>

<body>
  <!-- Top bar Start -->
  <div class="top-bar">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-6">
          <i class="fa fa-envelope"></i>
          support@shopstyle.com
        </div>
        <div class="col-sm-6 text-sm-right">
          <i class="fa fa-phone-alt"></i>
          +1 (234) 567-8900
        </div>
      </div>
    </div>
  </div>
  <!-- Top bar End -->

  <!-- Navigation Bar Start -->
  <div class="nav">
    <div class="container-fluid">
      <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="index.html">
          <!-- <span class="logo-text">ShopStyle</span> -->
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMain">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarMain">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="product-list.html">Products</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="product-detail.html">Product Detail</a>
            </li>
          </ul>

          <div class="navbar-nav ml-auto align-items-center">
            <div class="nav-item dropdown user-account" id="userAccountDropdown" style="display: none;">
              <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">
                <i class="fa fa-user-circle mr-1"></i> Account
              </a>
              <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" href="my-account.html">Dashboard</a>
                <a class="dropdown-item" href="#" id="logoutBtn">Logout</a>
              </div>
            </div>
            <a class="btn btn-sm btn-outline-primary" href="login.html" id="loginBtn">LOGIN</a>
          </div>
        </div>
      </nav>
    </div>
  </div>
  <!-- Navigation Bar End -->

  <!-- Search Bar Start -->
  <div class="bottom-bar">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-md-2">
          <div class="logo">
            <a href="index.html" class="font-logo">
              <span class="logo-text">ShopStyle</span>
            </a>
          </div>
        </div>
        <div class="col-md-8">
          <div class="search">
            <input type="text" id="searchInput" placeholder="Search for products, brands, and more...">
            <button id="searchBtn"><i class="fa fa-search"></i></button>
          </div>
        </div>
        <div class="col-md-2">
          <div class="user text-right">
            <a href="wishlist.html" class="btn wishlist">
              <i class="fa fa-heart"></i>
              <span id="wishlist-count">(0)</span>
            </a>
            <a href="cart.html" class="btn cart">
              <i class="fa fa-shopping-cart"></i>
              <span id="cart-count">(0)</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Search Bar End -->

  <!-- Breadcrumb Start -->
  <div class="breadcrumb-wrap">
    <div class="container-fluid">
      <ul class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="product-list.html">Products</a></li>
        <li class="breadcrumb-item active" id="breadcrumb-product">
          Product Detail
        </li>
      </ul>
    </div>
  </div>
  <!-- Breadcrumb End -->

  <!-- Product Detail Start -->
  <div class="product-detail">
    <div class="container-fluid">
      <!-- Loading Indicator -->
      <div id="loading-indicator" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-3">Loading product details...</p>
      </div>

      <!-- Error Message -->
      <div id="error-message" class="error-message" style="display: none">
        <i class="fa fa-exclamation-triangle fa-3x mb-3 text-danger"></i>
        <h3>Product Not Found</h3>
        <p class="text-muted">Sorry, we couldn't find the product you're looking for.</p>
        <a href="product-list.html" class="btn btn-primary mt-3">
          <i class="fa fa-arrow-left mr-2"></i>Back to Products
        </a>
      </div>

      <!-- Product Content -->
      <div id="product-detail-content" class="product-detail-content" style="display: none">
        <div class="row">
          <!-- Product Image Section -->
          <div class="col-lg-6">
            <div class="product-image-section">
              <div class="product-slider-single" id="product-image-slider">
                <!-- Product images will be loaded here dynamically -->
              </div>
            </div>
          </div>
          
          <!-- Product Info Section -->
          <div class="col-lg-3">
            <div class="product-detail-info">
              <div class="title">
                <h2 id="product-name">Product Name</h2>
                <!-- Short description added here -->
                <div class="product-short-description" id="product-short-description">
                  Loading description...
                </div>
              </div>
              <div class="ratting" id="product-rating">
                <i class="fa fa-star"></i>
                <i class="fa fa-star"></i>
                <i class="fa fa-star"></i>
                <i class="fa fa-star"></i>
                <i class="fa fa-star"></i>
              </div>
              <div class="price">
                <p id="product-price">₹99</p>
              </div>
              
              <div class="quantity">
                <h4>Quantity:</h4>
                <div class="qty">
                  <button class="btn-minus">
                    <i class="fa fa-minus"></i>
                  </button>
                  <input type="text" value="1" id="quantity-input" />
                  <button class="btn-plus">
                    <i class="fa fa-plus"></i>
                  </button>
                </div>
              </div>
              
              <div class="p-size">
                <h4>Size:</h4>
                <div class="btn-group" id="size-buttons">
                  <!-- Size buttons will be loaded dynamically -->
                </div>
              </div>
              
              <div class="action">
                <button class="btn btn-add-to-cart" id="add-to-cart-btn">
                  <i class="fa fa-shopping-cart"></i>Add to Cart
                </button>
                <button class="btn btn-buy-now" id="buy-now-btn">
                  <i class="fa fa-bolt"></i>Buy Now
                </button>
              </div>
            </div>
          </div>

          <!-- Sidebar Start -->
          <div class="col-lg-3 sidebar">
            <!-- Categories Sidebar -->
            <div class="category-sidebar-container" style="margin-top: 0;">
              <h3 class="category-title">
                <i class="fas fa-list mr-2"></i>Categories
              </h3>
              <nav class="navbar bg-light category-sidebar">
                <ul class="navbar-nav w-100" id="category-list">
                  <li class="nav-item text-center py-3">
                    <div class="spinner-border text-primary" role="status">
                      <span class="sr-only">Loading categories...</span>
                    </div>
                    <p class="mt-2 small text-muted">Loading categories...</p>
                  </li>
                </ul>
              </nav>
            </div>

            <!-- Featured Products -->
            <!-- <div class="sidebar-widget widget-slider">
              <h3 class="title">Featured Products</h3>
              <div class="sidebar-slider normal-slider" id="sidebar-products-slider">
                <div class="text-center p-4">
                  <i class="fa fa-spinner fa-spin fa-2x"></i>
                  <p class="mt-2">Loading featured products...</p>
                </div>
              </div>
            </div> -->
          </div>
          <!-- Sidebar End -->
        </div>

        <!-- Product Tabs - Only Description and Reviews -->
        <div class="row">
          <div class="col-lg-12">
            <div class="product-tabs">
              <ul class="nav nav-pills nav-justified">
                <li class="nav-item">
                  <a class="nav-link active" data-toggle="pill" href="#description">
                    <i class="fa fa-file-alt mr-2"></i>Full Description
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" data-toggle="pill" href="#reviews">
                    <i class="fa fa-star mr-2"></i>Reviews
                  </a>
                </li>
              </ul>

              <div class="tab-content">
                <div id="description" class="container tab-pane active">
                  <h4>Product Description</h4>
                  <div id="product-description" class="text-muted">
                    Loading product description...
                  </div>
                </div>
                <div id="reviews" class="container tab-pane fade">
                  <div id="reviews-container">
                    <!-- Reviews will be loaded here dynamically -->
                    <div class="text-center p-4">
                      <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                      <p class="mt-2">Loading reviews...</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Product Detail End -->

  <!-- Footer Start -->
  <div class="footer">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-3 col-md-6">
          <div class="footer-widget">
            <h2>ShopStyle</h2>
            <div class="contact-info">
              <p><i class="fa fa-map-marker"></i>123 Business Street, New York, NY 10001</p>
              <p><i class="fa fa-envelope"></i>support@shopstyle.com</p>
              <p><i class="fa fa-phone"></i>+1 (234) 567-8900</p>
            </div>
            <div class="social">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-linkedin-in"></i></a>
              <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="footer-widget">
            <h2>Quick Links</h2>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="product-list.html">Products</a></li>
              <li><a href="about.html">About Us</a></li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="footer-widget">
            <h2>Customer Service</h2>
            <ul>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="shipping.html">Shipping Policy</a></li>
              <li><a href="returns.html">Return Policy</a></li>
              <li><a href="privacy.html">Privacy Policy</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <div class="footer-widget">
            <h2>My Account</h2>
            <ul>
              <li><a href="my-account.html">My Account</a></li>
              <li><a href="order-history.html">Order History</a></li>
              <li><a href="wishlist.html">Wishlist</a></li>
              <li><a href="newsletter.html">Newsletter</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="row payment align-items-center">
        <div class="col-md-6">
          <div class="payment-method">
            <h3>We Accept:</h3>
            <img src="img/payment-method.png" alt="Payment Methods">
          </div>
        </div>
        <div class="col-md-6">
          <div class="payment-security">
            <h3>Secured By:</h3>
            <img src="img/godaddy.svg" alt="GoDaddy">
            <img src="img/norton.svg" alt="Norton">
            <img src="img/ssl.svg" alt="SSL">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Bottom -->
  <div class="footer-bottom">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <p>&copy; 2024 ShopStyle. All rights reserved.</p>
        </div>
        <div class="col-md-6 text-right">
          <p>Designed with <i class="fa fa-heart text-danger"></i> for modern eCommerce</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Back to Top -->
  <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

  <!-- JavaScript Libraries -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/slick/slick.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

  <script>
    // ========== NOTYF NOTIFICATION SETUP ==========
    const notyf = new Notyf({
      duration: 3000,
      position: {
        x: 'right',
        y: 'top',
      },
      types: [
        {
          type: 'success',
          background: '#10b981',
          icon: {
            className: 'fas fa-check-circle',
            tagName: 'i',
            color: '#fff'
          }
        },
        {
          type: 'error',
          background: '#ef4444',
          icon: {
            className: 'fas fa-exclamation-circle',
            tagName: 'i',
            color: '#fff'
          }
        },
        {
          type: 'warning',
          background: '#f59e0b',
          icon: {
            className: 'fas fa-exclamation-triangle',
            tagName: 'i',
            color: '#fff'
          }
        },
        {
          type: 'info',
          background: '#3b82f6',
          icon: {
            className: 'fas fa-info-circle',
            tagName: 'i',
            color: '#fff'
          }
        }
      ]
    });

    // ========== GLOBAL VARIABLES ==========
    let currentProduct = null;
    let selectedSize = null;
    let currentQuantity = 1;
    let basePrice = 0;
    let productImages = [];
    let currentSlideIndex = 0;
    let zoomEnabled = true;
    let zoomLevel = 1.0;

    // ========== INITIALIZATION ==========
    document.addEventListener("DOMContentLoaded", function() {
      console.log('Product detail page loaded');
      
      // Setup authentication
      setupAuth();
      
      // Setup event listeners
      setupEventListeners();
      
      // Load product details
      loadProductDetails();
      
      // Setup quantity controls
      setupQuantityControls();

      // Handle window resize for zoom
    window.addEventListener('resize', function() {
        if (zoomEnabled) {
            setTimeout(() => {
                const img = document.getElementById("mainProductImage");
                if (img && img.complete) {
                    initZoomFeature();
                }
            }, 300);
        }
    });
    });

    // ========== AUTHENTICATION ==========
    function setupAuth() {
      const token = localStorage.getItem("token");
      const isLoggedIn = token !== null && token !== undefined && token !== "";

      const userAccount = document.getElementById("userAccountDropdown");
      const loginBtn = document.getElementById("loginBtn");
      const protectedMenus = document.querySelectorAll('.protected-menu');

      if (isLoggedIn) {
        if (userAccount) userAccount.style.display = "block";
        if (loginBtn) loginBtn.style.display = "none";
        protectedMenus.forEach(menu => {
          if (menu) menu.style.display = "block";
        });

        updateCartCountDisplay();
      } else {
        if (userAccount) userAccount.style.display = "none";
        if (loginBtn) loginBtn.style.display = "inline-block";
        protectedMenus.forEach(menu => {
          if (menu) menu.style.display = "none";
        });
      }

      // Logout functionality
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", function (e) {
          e.preventDefault();

          localStorage.removeItem("token");
          localStorage.removeItem("userId");
          localStorage.removeItem("userName");
          localStorage.removeItem("userEmail");
          localStorage.removeItem("cartCount");

          notyf.success('Logged out successfully');
          setTimeout(() => {
            window.location.href = "index.html";
          }, 1500);
        });
      }
    }

    function updateCartCountDisplay() {
      try {
        const cartCount = localStorage.getItem('cartCount') || '0';
        document.querySelectorAll('#cart-count').forEach(el => {
          el.textContent = `(${cartCount})`;
        });
      } catch (error) {
        console.error('Error updating cart count:', error);
      }
    }

    // ========== HELPER FUNCTIONS ==========
    function getProductIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get("id");
    }

    function getImageUrl(imageSrc) {
      if (!imageSrc) return "img/product-1.jpg";
      
      if (imageSrc.startsWith("http") || imageSrc.startsWith("/")) {
        return imageSrc;
      }
      
      if (imageSrc.startsWith("uploads/")) {
        imageSrc = imageSrc.replace("uploads/", "");
      }
      
      return `/uploads/${imageSrc}`;
    }

    // ========== PRODUCT LOADING ==========
    async function loadProductDetails() {
      const productId = getProductIdFromURL();
      if (!productId) {
        showError();
        return;
      }

      try {
        showLoading();
        const response = await fetch(`/api/user/products/${productId}`);
        
        if (!response.ok) {
          throw new Error("Product not found");
        }

        const data = await response.json();
        
        if (data.success) {
          currentProduct = data.product;
          console.log("Product data from backend:", currentProduct);
          console.log("Product rating from backend:", currentProduct.rating);
          
          displayProductDetails(currentProduct);
          showContent();
          
          // Load reviews after product details are loaded
          await loadProductReviews(productId);
        } else {
          throw new Error(data.message || "Failed to load product");
        }
      } catch (error) {
        console.error("Error loading product:", error);
        showError();
      }
    }

    function displayProductDetails(product) {
      // Update product info
      document.getElementById("product-name").textContent = product.name;
      document.getElementById("breadcrumb-product").textContent = product.name;
      
      // Update short description
      updateShortDescription(product);
      
      // Update price with ₹ sign only (no discounted price)
      basePrice = parseFloat(product.price) || 0;
      updatePriceDisplay();
      
      // Update images with zoom and thumbnails
      updateProductImages(product);
      
      // Update full description
      updateFullDescription(product);
      
      // Update rating with initial product rating
      updateProductRating(product.rating || 0);
      
      // Update size options
      updateSizeOptions();
      
      // Load sidebar data
      loadSidebarData();
      
      // Setup cart buttons
      setupAddToCart();
    }

    // ========== DESCRIPTION FUNCTIONS ==========
    function updateShortDescription(product) {
      const shortDescElement = document.getElementById("product-short-description");
      if (!shortDescElement) return;
      
      if (product.shortDescription) {
        shortDescElement.textContent = product.shortDescription;
        shortDescElement.classList.remove('text-muted');
      } else if (product.description) {
        // Create a short version from the full description
        const fullDesc = product.description;
        let shortDesc = fullDesc;
        
        // Take first 150 characters or first sentence
        if (fullDesc.length > 150) {
          shortDesc = fullDesc.substring(0, 150).trim() + '...';
        }
        
        shortDescElement.textContent = shortDesc;
        shortDescElement.classList.remove('text-muted');
      } else {
        shortDescElement.textContent = "No description available.";
        shortDescElement.classList.add('text-muted');
      }
    }

    function updateFullDescription(product) {
      const descriptionElement = document.getElementById("product-description");
      if (product.description) {
        // Format description with paragraphs if it has multiple lines
        const descriptionText = product.description;
        if (descriptionText.includes('\n')) {
          const paragraphs = descriptionText.split('\n').filter(p => p.trim());
          descriptionElement.innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');
        } else {
          descriptionElement.textContent = descriptionText;
        }
        descriptionElement.classList.remove('text-muted');
      } else {
        descriptionElement.textContent = "No description available.";
        descriptionElement.classList.add('text-muted');
      }
    }

    // ========== PRICE DISPLAY ==========
    function updatePriceDisplay() {
      if (!basePrice) return;
      
      const totalPrice = basePrice * currentQuantity;
      
      const priceElement = document.getElementById("product-price");
      if (priceElement) {
        priceElement.innerHTML = `₹${totalPrice.toFixed(2)}`;
      }
    }

    // ========== PRODUCT RATING ==========
    function updateProductRating(rating) {
      const container = document.getElementById("product-rating");
      if (!container) return;
      
      container.innerHTML = "";
      
      // Convert rating to number
      const ratingValue = parseFloat(rating) || 0;
      
      console.log("updateProductRating called with:", ratingValue);
      
      // Show filled stars based on rating value (1-5 scale)
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement("i");
        
        if (i <= ratingValue) {
          // Full star for ratings >= current position
          star.className = "fa fa-star";
          star.style.color = "#fbbf24";
        } else {
          // Empty star
          star.className = "far fa-star";
          star.style.color = "#cccccc";
        }
        
        container.appendChild(star);
      }
      
      // Add the numeric rating as text
      const ratingText = document.createElement("span");
      ratingText.className = "rating-text ml-2";
      ratingText.textContent = `(${ratingValue.toFixed(1)})`;
      ratingText.style.fontSize = "14px";
      ratingText.style.color = "#666";
      container.appendChild(ratingText);
    }

    async function loadProductReviews(productId) {
      try {
        console.log(`Fetching reviews for product: ${productId}`);
        
        const response = await fetch(`/api/user/products/${productId}/reviews`);
        
        console.log(`Response status: ${response.status}`);
        
        if (!response.ok) {
          console.error(`Failed to fetch reviews: ${response.status} - ${response.statusText}`);
          displayNoReviews();
          return;
        }

        const data = await response.json();
        console.log("Reviews API response:", data);
        
        if (data.success && data.reviews && data.reviews.length > 0) {
          console.log(`Found ${data.reviews.length} reviews`);
          console.log(`Average rating: ${data.averageRating}`);
          
          // Update the product rating display with average rating
          const averageRating = parseFloat(data.averageRating) || 0;
          updateProductRating(averageRating);
          
          // Also update the product rating in the sidebar if needed
          if (currentProduct) {
            currentProduct.rating = averageRating;
          }
          
          displayReviews(data.reviews);
        } else {
          console.log("No reviews found or empty response");
          displayNoReviews();
          // If no reviews, show the original product rating or 0
          const productRating = currentProduct?.rating || 0;
          updateProductRating(productRating);
        }
      } catch (error) {
        console.error("Error loading reviews:", error);
        displayNoReviews();
      }
    }

    function displayReviews(reviews) {
      const reviewsContainer = document.getElementById("reviews-container");
      
      if (!reviewsContainer) {
        console.error("Reviews container not found");
        return;
      }
      
      if (!reviews || reviews.length === 0) {
        displayNoReviews();
        return;
      }
      
      let reviewsHTML = '<div class="reviews-container">';
      
      reviews.forEach((review, index) => {
        const user = review.user || {};
        const userName = user.name || "Anonymous User";
        const userEmail = user.email || "";
        const displayName = userName || (userEmail ? userEmail.split('@')[0] : "Anonymous User");
        
        // Format date from review.createdAt
        const reviewDate = new Date(review.createdAt);
        const formattedDate = reviewDate.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });
        
        const rating = review.rating || 0;
        const comment = review.comment || review.text || "No comment provided.";
        
        // Create rating stars
        let ratingStars = "";
        
        for (let i = 1; i <= 5; i++) {
          if (i <= rating) {
            ratingStars += '<i class="fa fa-star"></i>';
          } else {
            ratingStars += '<i class="far fa-star"></i>';
          }
        }
        
        reviewsHTML += `
          <div class="review-item">
            <div class="review-header">
              <div>
                <div class="reviewer-name">${displayName}</div>
                <div class="review-date">${formattedDate}</div>
              </div>
              <div class="ratting">
                ${ratingStars}
                <span class="ml-2 text-muted">(${rating.toFixed(1)})</span>
              </div>
            </div>
            <p>${comment}</p>
          </div>
        `;
      });
      
      reviewsHTML += '</div>';
      reviewsContainer.innerHTML = reviewsHTML;
    }

    function displayNoReviews() {
      const reviewsContainer = document.getElementById("reviews-container");
      
      if (reviewsContainer) {
        reviewsContainer.innerHTML = `
          <div class="no-reviews">
            <i class="far fa-comment-alt fa-3x"></i>
            <h4>No Reviews Yet</h4>
            <p class="text-muted">Be the first to review this product!</p>
          </div>
        `;
      }
    }

    // ========== PRODUCT IMAGES WITH ZOOM ==========
    function updateProductImages(product) {
      const slider = document.getElementById("product-image-slider");
      slider.innerHTML = "";
      
      // Get product images array
      productImages = product.image || [];
      if (!Array.isArray(productImages)) {
        productImages = [productImages];
      }
      
      if (productImages.length === 0) {
        productImages.push("img/product-1.jpg");
      }
      
      // Create zoom container and main image
      createZoomImageSlider(product, productImages);
      
      // Create thumbnails if multiple images
      if (productImages.length > 1) {
        createThumbnailsForSlider(product, productImages);
      }
    }

    function createZoomImageSlider(product, images) {
      // Create zoom container
      const zoomContainer = document.createElement("div");
      zoomContainer.className = "zoom-container";
      zoomContainer.id = "zoomContainer";

      // Create main product image
      const mainImg = document.createElement("img");
      mainImg.id = "mainProductImage";
      mainImg.src = getImageUrl(images[0]);
      mainImg.alt = `${product.name} - Main Image`;
      mainImg.onerror = function () {
        this.src = "img/product-1.jpg";
        setTimeout(() => initZoomFeature(), 100);
      };

      // Add navigation buttons if multiple images
      if (images.length > 1) {
        const prevBtn = document.createElement("button");
        prevBtn.innerHTML = '<i class="fa fa-chevron-left"></i>';
        prevBtn.className = "slider-btn slider-prev";
        prevBtn.addEventListener("click", () => changeSlide(-1));

        const nextBtn = document.createElement("button");
        nextBtn.innerHTML = '<i class="fa fa-chevron-right"></i>';
        nextBtn.className = "slider-btn slider-next";
        nextBtn.addEventListener("click", () => changeSlide(1));

        zoomContainer.appendChild(prevBtn);
        zoomContainer.appendChild(nextBtn);
      }

      zoomContainer.appendChild(mainImg);
      document.getElementById("product-image-slider").appendChild(zoomContainer);

      // Initialize zoom after image loads
      mainImg.onload = function () {
        console.log("Main product image loaded, initializing zoom...");
        setTimeout(() => initZoomFeature(), 100);
      };
    }

    function createThumbnailsForSlider(product, images) {
      const thumbnailsContainer = document.createElement("div");
      thumbnailsContainer.className = "product-thumbnails";

      images.forEach((imageSrc, index) => {
        const thumbnailDiv = document.createElement("div");
        thumbnailDiv.className = "thumbnail-item";
        thumbnailDiv.dataset.index = index;

        // Add active class to first thumbnail
        if (index === 0) {
          thumbnailDiv.classList.add("active");
        }

        const thumbnailImg = document.createElement("img");
        thumbnailImg.src = getImageUrl(imageSrc);
        thumbnailImg.alt = `${product.name} - Thumbnail ${index + 1}`;
        thumbnailImg.onerror = function () {
          this.src = "img/product-1.jpg";
        };

        // Add click event to switch to this image
        thumbnailDiv.addEventListener("click", () => {
          switchToImage(index);
        });

        thumbnailDiv.appendChild(thumbnailImg);
        thumbnailsContainer.appendChild(thumbnailDiv);
      });

      // Add thumbnails to the slider container
      const sliderContainer = document.querySelector(".product-slider-single");
      if (sliderContainer) {
        sliderContainer.appendChild(thumbnailsContainer);
      }
    }

    function changeSlide(direction) {
      if (productImages.length <= 1) return;

      // Calculate new index
      currentSlideIndex = (currentSlideIndex + direction + productImages.length) % productImages.length;

      // Update main image
      const mainImg = document.getElementById("mainProductImage");
      if (mainImg) {
        mainImg.src = getImageUrl(productImages[currentSlideIndex]);
        mainImg.alt = `${currentProduct.name} - Image ${currentSlideIndex + 1}`;

        // Update zoom result image when main image changes
        setTimeout(() => {
          const resultImg = document.querySelector("#zoomResultImage");
          if (resultImg) {
            resultImg.src = mainImg.src;
          }
          // Re-initialize zoom for new image
          initZoomFeature();
        }, 100);
      }

      // Update active thumbnail
      updateActiveThumbnail(currentSlideIndex);
    }

    function switchToImage(index) {
      if (index < 0 || index >= productImages.length) return;

      // Update current slide index
      currentSlideIndex = index;

      // Update main image
      const mainImg = document.getElementById("mainProductImage");
      if (mainImg) {
        mainImg.src = getImageUrl(productImages[index]);
        mainImg.alt = `${currentProduct.name} - Image ${index + 1}`;

        // Update zoom result image
        setTimeout(() => {
          const resultImg = document.querySelector("#zoomResultImage");
          if (resultImg) {
            resultImg.src = mainImg.src;
          }
          // Re-initialize zoom for new image
          initZoomFeature();
        }, 100);
      }

      // Update active thumbnail
      updateActiveThumbnail(index);
    }

    function updateActiveThumbnail(index) {
      const thumbnails = document.querySelectorAll(".thumbnail-item");
      thumbnails.forEach((thumb, thumbIndex) => {
        if (thumbIndex === index) {
          thumb.classList.add("active");
        } else {
          thumb.classList.remove("active");
        }
      });
    }

    // ========== IMPROVED ZOOM FEATURE FUNCTIONS ==========
function initZoomFeature() {
    // Only enable zoom on desktop screens (width > 992px)
    if (window.innerWidth <= 992) {
        console.log("Zoom disabled on mobile devices");
        zoomEnabled = false;
        
        // Remove zoom controls on mobile
        const controls = document.querySelector(".zoom-controls");
        if (controls) {
            controls.style.display = "none";
        }
        return;
    }

    const img = document.getElementById("mainProductImage");
    if (!img) {
        console.error("Main product image not found for zoom");
        return;
    }

    // Reset zoom level to default
    zoomLevel = 2.0; // Reduced from 2.5 for better starting point
    
    // Create zoom elements
    createZoomElements(img);
    
    // Wait for image to load completely
    if (!img.complete) {
        img.onload = function() {
            setTimeout(() => setupZoomComplete(img), 100);
        };
    } else {
        setupZoomComplete(img);
    }
}

function createZoomElements(img) {
    const container = document.querySelector(".zoom-container");
    
    // Remove existing zoom elements if they exist
    const existingLens = document.querySelector(".zoom-lens");
    const existingResult = document.querySelector(".zoom-result");
    if (existingLens) existingLens.remove();
    if (existingResult) existingResult.remove();
    
    // Create zoom lens element
    const lens = document.createElement("div");
    lens.className = "zoom-lens";
    lens.style.display = "none";
    container.appendChild(lens);
    
    // Create zoom result element
    const result = document.createElement("div");
    result.className = "zoom-result";
    result.style.display = "none";
    document.querySelector(".product-image-section").appendChild(result);
    
    // Create image inside zoom result
    const resultImg = document.createElement("img");
    resultImg.id = "zoomResultImage";
    resultImg.src = img.src;
    resultImg.alt = "Zoomed product image";
    result.appendChild(resultImg);
    
    // Create zoom controls if they don't exist
    createZoomControls();
}

function setupZoomComplete(img) {
    // Get actual image dimensions
    const imgRect = img.getBoundingClientRect();
    const naturalWidth = img.naturalWidth;
    const naturalHeight = img.naturalHeight;
    
    console.log("Image dimensions:", {
        display: {width: imgRect.width, height: imgRect.height},
        natural: {width: naturalWidth, height: naturalHeight}
    });

    // Calculate the correct scale between displayed and natural image
    const resultImg = document.getElementById("zoomResultImage");
    if (!resultImg) return;
    
    // Calculate aspect ratios
    const displayRatio = imgRect.width / imgRect.height;
    const naturalRatio = naturalWidth / naturalHeight;
    
    // Determine which dimension limits the display
    let scale;
    if (displayRatio > naturalRatio) {
        // Height is limiting factor
        scale = naturalHeight / imgRect.height;
    } else {
        // Width is limiting factor
        scale = naturalWidth / imgRect.width;
    }
    
    console.log("Calculated scale:", scale);
    
    // Set lens size based on zoom level (smaller lens for better accuracy)
    const lens = document.querySelector(".zoom-lens");
    if (lens) {
        // Smaller lens size for better precision
        const lensSize = Math.min(imgRect.width, imgRect.height) / (zoomLevel * 1.5);
        lens.style.width = lensSize + "px";
        lens.style.height = lensSize + "px";
    }
    
    // Setup zoom events
    setupZoomEvents(img, scale);
    
    console.log("Zoom feature initialized with level:", zoomLevel);
}
function setupZoomEvents(img, scale) {
    const container = img.parentElement;
    const lens = document.querySelector(".zoom-lens");
    const result = document.querySelector(".zoom-result");
    const resultImg = document.getElementById("zoomResultImage");
    
    if (!lens || !result || !resultImg) return;
    
    // Get image display dimensions
    const imgRect = img.getBoundingClientRect();
    
    // Store scale for use in event handlers
    container.dataset.zoomScale = scale;
    container.dataset.imgWidth = imgRect.width;
    container.dataset.imgHeight = imgRect.height;
    
    // Mouse enter - show lens and result
    container.addEventListener("mouseenter", function(e) {
        if (!zoomEnabled) return;
        
        lens.style.display = "block";
        result.style.display = "block";
        
        // Position result container
        positionResultContainer(e, result);
        
        // Update zoom
        updateZoom(e, img, lens, result, resultImg, scale);
    });
    
    // Mouse leave - hide lens and result
    container.addEventListener("mouseleave", function() {
        lens.style.display = "none";
        result.style.display = "none";
    });
    
    // Mouse move - update lens and zoom result
    container.addEventListener("mousemove", function(e) {
        if (!zoomEnabled) return;
        
        // Position result container
        positionResultContainer(e, result);
        
        // Update zoom
        updateZoom(e, img, lens, result, resultImg, scale);
    });
}

function positionResultContainer(e, result) {
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    
    // Position result to the right of cursor, or left if near right edge
    let resultLeft = e.clientX + 20;
    let resultTop = e.clientY - 100; // Center vertically relative to cursor
    
    // Check if result would go off screen on the right
    if (resultLeft + 400 > viewportWidth) {
        resultLeft = e.clientX - 420; // Move to left side
    }
    
    // Check if result would go off screen on the bottom
    if (resultTop + 400 > viewportHeight) {
        resultTop = viewportHeight - 420;
    }
    
    // Check if result would go off screen on the top
    if (resultTop < 20) {
        resultTop = 20;
    }
    
    result.style.left = resultLeft + "px";
    result.style.top = resultTop + "px";
}

function updateZoom(e, img, lens, result, resultImg, scale) {
    // Get container and image positions
    const container = img.parentElement;
    const containerRect = container.getBoundingClientRect();
    const imgRect = img.getBoundingClientRect();
    
    // Calculate cursor position relative to the image (not container)
    const containerLeft = containerRect.left + (containerRect.width - imgRect.width) / 2;
    const containerTop = containerRect.top + (containerRect.height - imgRect.height) / 2;
    
    let cursorX = e.clientX - containerLeft;
    let cursorY = e.clientY - containerTop;
    
    // Constrain cursor position to image bounds
    cursorX = Math.max(0, Math.min(cursorX, imgRect.width));
    cursorY = Math.max(0, Math.min(cursorY, imgRect.height));
    
    // Calculate lens position (center lens on cursor)
    const lensSize = parseInt(lens.style.width) || 100;
    let lensX = cursorX - lensSize / 2;
    let lensY = cursorY - lensSize / 2;
    
    // Constrain lens within image bounds
    lensX = Math.max(0, Math.min(lensX, imgRect.width - lensSize));
    lensY = Math.max(0, Math.min(lensY, imgRect.height - lensSize));
    
    // Apply lens position
    lens.style.left = (lensX + (containerRect.width - imgRect.width) / 2) + "px";
    lens.style.top = (lensY + (containerRect.height - imgRect.height) / 2) + "px";
    
    // Calculate what portion of the image is shown in the lens
    // This is the critical part for accuracy
    const xRatio = lensX / (imgRect.width - lensSize) || 0;
    const yRatio = lensY / (imgRect.height - lensSize) || 0;
    
    // Calculate the visible area in the zoom result
    const resultWidth = 400; // Fixed result container width
    const resultHeight = 400; // Fixed result container height
    
    // The result image is scaled up by the scale factor
    // We need to move it to show the area under the lens
    const moveX = -xRatio * (resultImg.naturalWidth * zoomLevel - resultWidth);
    const moveY = -yRatio * (resultImg.naturalHeight * zoomLevel - resultHeight);
    
    // Apply transform to zoom result image
    resultImg.style.transform = `translate(${moveX}px, ${moveY}px) scale(${zoomLevel})`;
    resultImg.style.transformOrigin = 'top left';
}

    function createZoomControls() {
      const container = document.querySelector(".zoom-container");
      if (!container || container.querySelector(".zoom-controls")) return;

      const controls = document.createElement("div");
      controls.className = "zoom-controls";

      const zoomInBtn = document.createElement("button");
      zoomInBtn.className = "zoom-btn";
      zoomInBtn.innerHTML = '<i class="fa fa-search-plus"></i>';
      zoomInBtn.title = "Zoom In";
      zoomInBtn.onclick = () => adjustZoomLevel(0.2);

      const zoomOutBtn = document.createElement("button");
      zoomOutBtn.className = "zoom-btn";
      zoomOutBtn.innerHTML = '<i class="fa fa-search-minus"></i>';
      zoomOutBtn.title = "Zoom Out";
      zoomOutBtn.onclick = () => adjustZoomLevel(-0.2);

      const resetBtn = document.createElement("button");
      resetBtn.className = "zoom-btn";
      resetBtn.innerHTML = '<i class="fa fa-sync-alt"></i>';
      resetBtn.title = "Reset Zoom";
      resetBtn.onclick = () => resetZoomLevel();

      controls.appendChild(zoomInBtn);
      controls.appendChild(zoomOutBtn);
      controls.appendChild(resetBtn);

      container.appendChild(controls);
    }

function adjustZoomLevel(change) {
    const newZoom = zoomLevel + change;
    if (newZoom >= 1.5 && newZoom <= 3.0) {
        zoomLevel = newZoom;
        console.log("Zoom level changed to:", zoomLevel);
        
        // Update lens size based on new zoom level
        const lens = document.querySelector(".zoom-lens");
        if (lens) {
            const img = document.getElementById("mainProductImage");
            if (img) {
                const imgRect = img.getBoundingClientRect();
                // Adjust lens size inversely with zoom level
                const lensSize = Math.min(imgRect.width, imgRect.height) / (zoomLevel * 1.5);
                lens.style.width = lensSize + "px";
                lens.style.height = lensSize + "px";
            }
        }
    }
}

function resetZoomLevel() {
    zoomLevel = 2.0;
    console.log("Zoom level reset to:", zoomLevel);
    
    // Update lens size
    const lens = document.querySelector(".zoom-lens");
    if (lens) {
        const img = document.getElementById("mainProductImage");
        if (img) {
            const imgRect = img.getBoundingClientRect();
            const lensSize = Math.min(imgRect.width, imgRect.height) / (zoomLevel * 1.5);
            lens.style.width = lensSize + "px";
            lens.style.height = lensSize + "px";
        }
    }
}

    // ========== SIZE OPTIONS ==========
    function updateSizeOptions() {
      const sizeButtons = document.getElementById("size-buttons");
      sizeButtons.innerHTML = "";
      
      const sizes = ["S", "M", "L", "XL"];
      sizes.forEach((size) => {
        const button = document.createElement("button");
        button.type = "button";
        button.className = "btn";
        button.textContent = size;
        button.addEventListener("click", () => selectSize(size, button));
        sizeButtons.appendChild(button);
      });
      
      // Auto-select first size
      if (sizes.length > 0) {
        setTimeout(() => {
          const firstSizeBtn = sizeButtons.querySelector(".btn");
          if (firstSizeBtn) {
            selectSize(sizes[0], firstSizeBtn);
          }
        }, 100);
      }
    }

    function selectSize(size, button) {
      selectedSize = size;
      
      // Remove active class from all size buttons
      document.querySelectorAll("#size-buttons .btn").forEach((btn) => {
        btn.classList.remove("active");
      });
      
      // Add active class to selected button
      button.classList.add("active");
    }

    // ========== QUANTITY CONTROLS ==========
    function setupQuantityControls() {
      const minusBtn = document.querySelector(".btn-minus");
      const plusBtn = document.querySelector(".btn-plus");
      const quantityInput = document.getElementById("quantity-input");
      
      if (!minusBtn || !plusBtn || !quantityInput) return;
      
      // Set initial quantity
      currentQuantity = 1;
      quantityInput.value = currentQuantity;
      
      minusBtn.addEventListener("click", function() {
        if (currentQuantity > 1) {
          currentQuantity--;
          quantityInput.value = currentQuantity;
          updatePriceDisplay();
        }
      });
      
      plusBtn.addEventListener("click", function() {
        currentQuantity++;
        quantityInput.value = currentQuantity;
        updatePriceDisplay();
      });
      
      quantityInput.addEventListener("change", function() {
        let value = parseInt(this.value);
        if (isNaN(value) || value < 1) {
          value = 1;
          this.value = 1;
        }
        currentQuantity = value;
        updatePriceDisplay();
      });
    }

    // ========== CART FUNCTIONS ==========
    function setupAddToCart() {
      const addToCartBtn = document.getElementById("add-to-cart-btn");
      const buyNowBtn = document.getElementById("buy-now-btn");
      
      if (addToCartBtn) {
        addToCartBtn.addEventListener("click", function(e) {
          e.preventDefault();
          handleAddToCart(false);
        });
      }
      
      if (buyNowBtn) {
        buyNowBtn.addEventListener("click", function(e) {
          e.preventDefault();
          handleAddToCart(true);
        });
      }
    }

    function handleAddToCart(isBuyNow = false) {
      if (!selectedSize) {
        notyf.error("Please select a size");
        return;
      }
      
      if (!currentProduct) {
        notyf.error("Product information not available");
        return;
      }
      
      addToCartToBackend(isBuyNow);
    }

    async function addToCartToBackend(isBuyNow = false) {
      const productId = getProductIdFromURL();
      const token = localStorage.getItem("token");
      
      if (!token) {
        notyf.error("Please login to add items to cart");
        window.location.href = "login.html";
        return;
      }
      
      try {
        const response = await fetch("/api/user/cart/addtocart", {
          method: "POST",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            productId: productId,
            quantity: currentQuantity,
            size: selectedSize,
          }),
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem("token");
            localStorage.removeItem("userId");
            notyf.error("Token expired. Please login again.");
            window.location.href = "login.html";
            return;
          }
          throw new Error(data.message || `HTTP error! status: ${response.status}`);
        }
        
        if (!data.success) {
          throw new Error(data.message || "Failed to add to cart");
        }
        
        // Update cart count
        updateCartCountFromResponse(data);
        
        // Show success message
        notyf.success(`✓ Added ${currentQuantity} ${currentProduct.name} (${selectedSize}) to cart!`);
        
        // Redirect if Buy Now
        if (isBuyNow) {
          setTimeout(() => {
            window.location.href = "checkout.html";
          }, 500);
        }
        
      } catch (error) {
        console.error("Error adding to cart:", error);
        notyf.error("Error adding product to cart: " + error.message);
      }
    }

    function updateCartCountFromResponse(data) {
      let cartCount = 0;
      
      // Try different response formats
      if (data.cart && data.cart.totalItems !== undefined) {
        cartCount = data.cart.totalItems;
      } else if (data.totalItems !== undefined) {
        cartCount = data.totalItems;
      } else if (data.cart && data.cart.items && Array.isArray(data.cart.items)) {
        cartCount = data.cart.items.length;
      } else if (data.items && Array.isArray(data.items)) {
        cartCount = data.items.length;
      }
      
      // Update localStorage
      if (cartCount > 0) {
        localStorage.setItem("cartCount", cartCount.toString());
      } else {
        // Increment existing count
        const currentCount = parseInt(localStorage.getItem("cartCount") || "0");
        cartCount = currentCount + 1;
        localStorage.setItem("cartCount", cartCount.toString());
      }
      
      // Update display
      updateCartCountDisplay();
    }

    // ========== EVENT LISTENERS ==========
    function setupEventListeners() {
      // Top search bar integration
      const searchInput = document.getElementById('searchInput');
      const searchBtn = document.getElementById('searchBtn');

      if (searchInput && searchBtn) {
        searchInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            handleTopSearch();
          }
        });

        searchBtn.addEventListener('click', function (e) {
          e.preventDefault();
          handleTopSearch();
        });
      }

      function handleTopSearch() {
        const query = searchInput.value.trim();

        if (!query) {
          notyf.error('Please enter something to search');
          return;
        }
        window.location.href = `product-list.html?search=${encodeURIComponent(query)}`;
      }
    }

    // ========== SIDEBAR FUNCTIONS ==========
    async function loadSidebarData() {
      try {
        // Load categories
        const catResponse = await fetch("/api/user/category/all");
        if (catResponse.ok) {
          const catData = await catResponse.json();
          if (catData.success && catData.data) {
            renderCategories(catData.data);
          }
        }
        
        // Load featured products for carousel
        await loadSidebarProducts();
      } catch (error) {
        console.error("Error loading sidebar data:", error);
      }
    }

    function renderCategories(categories) {
      const categoryList = document.getElementById("category-list");
      if (!categoryList) return;
      
      let html = '';
      
      // Add "All Categories" option
      html += `
        <li class="nav-item">
          <a class="nav-link" href="product-list.html">
            <i class="fa fa-list mr-2"></i>All Categories
          </a>
        </li>
      `;

      // Define category icons mapping
      const iconMap = {
        'Fashion': 'fa-tshirt',
        'Electronics': 'fa-laptop',
        'Mobile': 'fa-mobile-alt',
        'Clothing': 'fa-tshirt',
        'Men': 'fa-male',
        'Women': 'fa-female',
        'Kids': 'fa-child',
        'Beauty': 'fa-spa',
        'Accessories': 'fa-glasses',
        'Sports': 'fa-running',
        'Home': 'fa-home',
        'Kitchen': 'fa-utensils',
        'Furniture': 'fa-couch',
        'Books': 'fa-book',
        'Toys': 'fa-gamepad'
      };

      categories.forEach(category => {
        const categoryId = category._id || category.id || '';
        const categoryName = category.name || 'Unnamed Category';
        const iconClass = getCategoryIcon(categoryName, iconMap);
        
        html += `
          <li class="nav-item">
            <a class="nav-link" href="product-list.html?category=${categoryId}">
              <i class="fa ${iconClass} mr-2"></i>${categoryName}
            </a>
          </li>
        `;
      });
      
      categoryList.innerHTML = html;
    }

    function getCategoryIcon(categoryName, iconMap) {
      const normalizedName = categoryName.trim();
      
      if (iconMap[normalizedName]) {
        return iconMap[normalizedName];
      }
      
      for (const [key, value] of Object.entries(iconMap)) {
        if (normalizedName.toLowerCase().includes(key.toLowerCase()) ||
            key.toLowerCase().includes(normalizedName.toLowerCase())) {
          return value;
        }
      }
      
      return 'fa-tag';
    }

    async function loadSidebarProducts() {
      try {
        let products = [];

        // Try featured products first
        const featuredResponse = await fetch("/api/user/products?featured=true&limit=5");
        if (featuredResponse.ok) {
          const featuredData = await featuredResponse.json();
          if (featuredData.success && featuredData.products && featuredData.products.length > 0) {
            products = featuredData.products;
          }
        }

        // If no featured products, try latest products
        if (products.length === 0) {
          const latestResponse = await fetch("/api/user/products?limit=5&sort=-createdAt");
          if (latestResponse.ok) {
            const latestData = await latestResponse.json();
            if (latestData.success && latestData.products) {
              products = latestData.products;
            }
          }
        }

        // Render the products in sidebar slider
        renderSidebarSlider(products);
      } catch (error) {
        console.error("Error loading sidebar products:", error);
        // Use fallback products on error
        const fallbackProducts = getFallbackProducts();
        renderSidebarSlider(fallbackProducts);
      }
    }

    function renderSidebarSlider(products) { 
      const sliderContainer = document.getElementById("sidebar-products-slider");

      if (!sliderContainer) {
        console.error("Sidebar slider container not found");
        return;
      }

      if (!products || products.length === 0) {
        sliderContainer.innerHTML = `
          <div class="text-center p-4">
            <i class="fa fa-exclamation-circle fa-2x text-muted"></i>
            <p class="mt-2 text-muted">No products available</p>
          </div>
        `;
        return;
      }

      let productsHTML = "";
      let slideIndicatorsHTML = "";

      // Create product slides
      products.forEach((product, index) => {
        const productId = product._id || product.id || "";
        const productName = product.name || "Product Name";
        const productPrice = parseFloat(product.price) || 0;
        const productImage = getProductImageForSidebar(product.image || product.images || "");
        const productRating = parseFloat(product.rating) || 0;

        // Create rating stars with new logic
        let ratingStars = "";
        
        for (let i = 1; i <= 5; i++) {
          if (i <= productRating) {
            ratingStars += '<i class="fa fa-star"></i>';
          } else {
            ratingStars += '<i class="far fa-star"></i>';
          }
        }

        const activeClass = index === 0 ? "active" : "";

        productsHTML += `
          <div class="carousel-item ${activeClass}">
            <div class="product-item">
              <div class="product-title">
                <a href="product-detail.html?id=${productId}">${productName}</a>
                <div class="ratting">
                  ${ratingStars}
                </div>
              </div>
              <div class="product-image">
                <a href="product-detail.html?id=${productId}">
                  <img src="${productImage}" alt="${productName}" 
                       onerror="this.onerror=null; this.src='img/product-${Math.floor(Math.random() * 10) + 1}.jpg'">
                </a>
              </div>
              <div class="product-price">
                <h3><span>₹</span>${productPrice.toFixed(2)}</h3>
                <a class="btn" href="#" onclick="handleAddToCartFromSidebar(event, '${productId}')">
                  <i class="fa fa-shopping-cart"></i>Add to Cart
                </a>
              </div>
            </div>
          </div>
        `;

        // Create indicator
        const indicatorActiveClass = index === 0 ? "active" : "";
        slideIndicatorsHTML += `
          <li data-target="#sidebarCarousel" data-slide-to="${index}" class="${indicatorActiveClass}"></li>
        `;
      });

      // Build the complete slider HTML
      const completeSliderHTML = `
        <div id="sidebarCarousel" class="carousel slide" data-ride="carousel">
          <!-- Indicators -->
          <ol class="carousel-indicators">
            ${slideIndicatorsHTML}
          </ol>
          
          <!-- Slides -->
          <div class="carousel-inner">
            ${productsHTML}
          </div>
          
          <!-- Controls -->
          <a class="carousel-control-prev" href="#sidebarCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#sidebarCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      `;

      sliderContainer.innerHTML = completeSliderHTML;

      // Initialize the carousel
      initSidebarCarousel();
    }

    function initSidebarCarousel() {
      // Initialize Bootstrap carousel
      $('#sidebarCarousel').carousel({
        interval: 2000,
        pause: "hover",
        wrap: true,
        keyboard: true,
      });

      console.log("Sidebar carousel initialized");
    }

    function getProductImageForSidebar(imageSrc) {
      if (!imageSrc) return "img/product-7.jpg";

      // Handle array of images
      if (Array.isArray(imageSrc)) {
        imageSrc = imageSrc[0] || "img/product-7.jpg";
      }

      // If imageSrc already has a full path, use it
      if (imageSrc.startsWith("http") || imageSrc.startsWith("/")) {
        return imageSrc;
      }

      // Remove duplicate "uploads/" if present
      if (imageSrc.startsWith("uploads/")) {
        imageSrc = imageSrc.replace("uploads/", "");
      }

      // Otherwise, prepend the uploads path correctly
      return `/uploads/${imageSrc}`;
    }

    function getFallbackProducts() {
      return [
        {
          _id: "1",
          name: "Wireless Headphones",
          price: 99.99,
          image: "img/product-7.jpg",
          rating: 4.5,
        },
        {
          _id: "2",
          name: "Smart Watch",
          price: 199.99,
          image: "img/product-8.jpg",
          rating: 4.2,
        },
        {
          _id: "3",
          name: "Running Shoes",
          price: 79.99,
          image: "img/product-9.jpg",
          rating: 4.7,
        },
        {
          _id: "4",
          name: "Laptop Backpack",
          price: 49.99,
          image: "img/product-10.jpg",
          rating: 4.3,
        },
        {
          _id: "5",
          name: "Fitness Tracker",
          price: 89.99,
          image: "img/product-11.jpg",
          rating: 4.0,
        },
      ];
    }

    // ========== UI STATE FUNCTIONS ==========
    function showLoading() {
      document.getElementById("loading-indicator").style.display = "flex";
      document.getElementById("product-detail-content").style.display = "none";
      document.getElementById("error-message").style.display = "none";
    }

    function showError() {
      document.getElementById("loading-indicator").style.display = "none";
      document.getElementById("product-detail-content").style.display = "none";
      document.getElementById("error-message").style.display = "block";
    }

    function showContent() {
      document.getElementById("loading-indicator").style.display = "none";
      document.getElementById("error-message").style.display = "none";
      document.getElementById("product-detail-content").style.display = "block";
    }

    // ========== SIDEBAR ADD TO CART ==========
    async function handleAddToCartFromSidebar(event, productId) {
      event.preventDefault();
      event.stopPropagation();
      
      const token = localStorage.getItem('token');
      
      if (!token) {
        notyf.error('Please login to add items to cart');
        window.location.href = 'login.html';
        return;
      }
      
      try {
        const response = await fetch('/api/user/cart/addtocart', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            productId: productId,
            quantity: 1,
            size: 'M'
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          if (data.cart && data.cart.totalItems) {
            localStorage.setItem('cartCount', data.cart.totalItems.toString());
            updateCartCountDisplay();
          }
          notyf.success('Product added to cart!');
        } else {
          notyf.error('Failed to add to cart: ' + data.message);
        }
      } catch (error) {
        console.error('Error adding to cart:', error);
        notyf.error('Error adding product to cart. Please try again.');
      }
    }
  </script>
</body>
</html>