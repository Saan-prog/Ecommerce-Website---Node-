<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Manage Addresses - ShopStyle</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Modern eCommerce HTML Template" name="keywords" />
    <meta content="Contemporary eCommerce Template" name="description" />

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <!-- CSS Libraries -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
    <link href="lib/slick/slick.css" rel="stylesheet" />
    <link href="lib/slick/slick-theme.css" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet" />
    <style>
      :root {
        --primary: #2C3E50;
        --primary-dark: #5a52d5;
        --primary-hover: #7d75ff;
        --success: #28a745;
        --success-hover: #218838;
        --danger: #dc3545;
        --warning: #ffc107;
        --info: #17a2b8;
        --dark: #343a40;
        --light: #f8f9fa;
      }

      /* Manage Addresses Main Container */
      .manage-addresses-container {
        background-color: #ffffff;
        padding: 30px;
        border-radius: 10px;
        margin-top: 20px;
        margin-bottom: 40px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #eaeaea;
      }

      .manage-addresses-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
      }

      .manage-addresses-header h2 {
        color: var(--dark);
        font-weight: 700;
        margin: 0;
        font-size: 24px;
      }

      .manage-addresses-header h2 i {
        color: var(--primary);
      }

      /* Address Rows */
      .address-row {
        display: flex;
        align-items: center;
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
      }

      .address-row:hover {
        box-shadow: 0 4px 20px rgba(108, 99, 255, 0.1);
        transform: translateY(-3px);
        border-color: var(--primary);
      }

      .address-row.selected {
        border-color: var(--success);
        border-width: 2px;
        background-color: rgba(40, 167, 69, 0.03);
      }

      .address-row.default {
        border-color: var(--primary);
        border-width: 2px;
        background-color: rgba(108, 99, 255, 0.03);
      }

      .address-row.selected.default {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.03) 0%, rgba(108, 99, 255, 0.03) 100%);
      }

      /* Selection Radio */
      .address-selection {
        flex: 0 0 50px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .address-selection .form-check {
        margin: 0;
      }

      .address-selection .form-check-input {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      .address-selection .form-check-input:checked {
        background-color: var(--success);
        border-color: var(--success);
      }

      /* Address Details */
      .address-details {
        flex: 1;
        padding: 0 20px;
      }

      .address-details-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .address-name {
        font-weight: 600;
        color: var(--dark);
        font-size: 16px;
        margin: 0;
      }

      .address-type-badge {
        margin-left: 10px;
      }

      .address-type-badge .badge {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 12px;
        font-weight: 500;
      }

      .address-info {
        color: #666;
        line-height: 1.6;
      }

      .address-info p {
        margin-bottom: 6px;
        font-size: 14px;
      }

      .address-info i {
        color: var(--primary);
        width: 18px;
        margin-right: 8px;
      }

      /* Address Actions */
      .address-actions {
        flex: 0 0 180px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .address-actions .btn {
        font-size: 13px;
        padding: 8px 15px;
        width: 100%;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s;
      }

      .btn-set-default {
        background-color: var(--warning);
        border-color: var(--warning);
        color: #212529;
      }

      .btn-set-default:hover {
        background-color: #e0a800;
        border-color: #d39e00;
        color: #212529;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
      }

      .btn-edit {
        background-color: var(--info);
        border-color: var(--info);
        color: white;
      }

      .btn-edit:hover {
        background-color: #138496;
        border-color: #117a8b;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
      }

      .btn-delete {
        background-color: var(--danger);
        border-color: var(--danger);
        color: white;
      }

      .btn-delete:hover {
        background-color: #c82333;
        border-color: #bd2130;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
      }

      /* Action Buttons Container */
      .action-buttons-container {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #f0f0f0;
      }

      .add-address-btn {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s;
        font-size: 15px;
      }

      .add-address-btn:hover {
        background: linear-gradient(135deg, var(--primary-hover) 0%, var(--primary) 100%);
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(108, 99, 255, 0.3);
        color: white;
      }

      .proceed-checkout-btn {
        background: linear-gradient(135deg, var(--success) 0%, #1e7e34 100%);
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s;
        font-size: 15px;
      }

      .proceed-checkout-btn:hover {
        background: linear-gradient(135deg, var(--success-hover) 0%, var(--success) 100%);
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(40, 167, 69, 0.3);
        color: white;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        background-color: white;
        border-radius: 10px;
        border: 2px dashed #e0e0e0;
        margin: 20px 0;
      }

      .empty-state i {
        color: #ddd;
        font-size: 60px;
        margin-bottom: 20px;
      }

      .empty-state h4 {
        color: #666;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .empty-state p {
        color: #999;
        margin-bottom: 25px;
        font-size: 15px;
      }

      /* Loading State */
      .loading-state {
        text-align: center;
        padding: 50px 20px;
      }

      .loading-state p {
        color: #666;
        margin-top: 15px;
        font-size: 15px;
      }

      /* Selection Status */
      .selection-status {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
        border-left: 4px solid var(--success);
        padding: 18px;
        border-radius: 8px;
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .selection-status h6 {
        color: #155724;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .selection-status p {
        color: #666;
        margin: 0;
        font-size: 14px;
      }

      .no-selection-msg {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 18px;
        margin-bottom: 25px;
        text-align: center;
        color: #856404;
      }

      .no-selection-msg i {
        color: #ffc107;
        margin-right: 10px;
      }

      /* Modal Styles */
      .modal-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 20px;
      }

      .modal-title {
        color: white;
        font-weight: 600;
        font-size: 18px;
      }

      .modal-body {
        padding: 25px;
      }

      .modal-footer {
        border-top: 1px solid #eaeaea;
        padding: 20px;
      }

      .modal-footer .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        border: none;
        padding: 10px 25px;
        font-weight: 600;
      }

      .modal-footer .btn-primary:hover {
        background: linear-gradient(135deg, var(--primary-hover) 0%, var(--primary) 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
      }

      .form-label {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 8px;
        font-size: 14px;
      }

      .form-control {
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 10px 15px;
        font-size: 14px;
        transition: all 0.3s;
      }

      .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.2rem rgba(108, 99, 255, 0.15);
      }

      /* Badge for counts */
      .wishlist span, .cart span {
        /* background-color: var(--primary); */
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        min-width: 22px;
        display: inline-block;
        text-align: center;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .manage-addresses-container {
          padding: 20px;
          margin-left: -10px;
          margin-right: -10px;
          border-radius: 0;
          box-shadow: none;
          border: none;
        }

        .manage-addresses-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }

        .manage-addresses-header h2 {
          font-size: 20px;
        }

        .address-row {
          flex-direction: column;
          align-items: flex-start;
        }

        .address-selection {
          margin-bottom: 15px;
          flex: 0 0 auto;
          align-self: flex-start;
        }

        .address-details {
          padding: 0;
          margin-bottom: 20px;
          width: 100%;
        }

        .address-actions {
          flex: 0 0 auto;
          width: 100%;
          flex-direction: row;
          justify-content: space-between;
          gap: 10px;
        }

        .address-actions .btn {
          flex: 1;
          min-width: 0;
        }

        .action-buttons-container {
          flex-direction: column;
          gap: 10px;
        }

        .add-address-btn, .proceed-checkout-btn {
          width: 100%;
          text-align: center;
        }
      }

      @media (max-width: 576px) {
        .modal-dialog {
          margin: 10px;
        }
        
        .modal-body {
          padding: 20px 15px;
        }
        
        .address-actions {
          flex-direction: column;
        }
        
        .address-actions .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top bar Start -->
    <div class="top-bar">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-6">
            <i class="fa fa-envelope"></i>
            support@shopstyle.com
          </div>
          <div class="col-sm-6 text-sm-right">
            <i class="fa fa-phone-alt"></i>
            +1 (234) 567-8900
          </div>
        </div>
      </div>
    </div>
    <!-- Top bar End -->

    <!-- Navigation Bar Start -->
    <div class="nav">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg">
          <a class="navbar-brand" href="index.html">
            <!-- <span class="logo-text">ShopStyle</span> -->
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMain">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarMain">
            <ul class="navbar-nav mr-auto">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="product-list.html">Products</a>
              </li>
              <li class="nav-item protected-menu" style="display: none;">
                <a class="nav-link" href="cart.html" id="cartMenuItem">Cart</a>
              </li>
              <li class="nav-item protected-menu" style="display: none;">
                <a class="nav-link" href="checkout.html" id="checkoutMenuItem">Checkout</a>
              </li>
              <li class="nav-item protected-menu" style="display: none;">
                <a class="nav-link" href="order-history.html" id="orderMenuItem">My Orders</a>
              </li>
            </ul>

            <div class="navbar-nav ml-auto align-items-center">
              <div class="nav-item dropdown user-account" id="userAccountDropdown" style="display: none;">
                <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">
                  <i class="fa fa-user-circle mr-1"></i> Account
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                  <a class="dropdown-item" href="my-account.html">Dashboard</a>
                  <a class="dropdown-item" href="#" id="logoutBtn">Logout</a>
                </div>
              </div>
              <a class="btn btn-sm btn-outline-primary" href="login.html" id="loginBtn" style="display: none;">LOGIN</a>
            </div>
          </div>
        </nav>
      </div>
    </div>
    <!-- Navigation Bar End -->

    <!-- Search Bar Start -->
    <div class="bottom-bar">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-md-2">
            <div class="logo">
              <a href="index.html" class="font-logo">
                <span class="logo-text">ShopStyle</span>
              </a>
            </div>
          </div>
          <div class="col-md-8">
            <div class="search">
              <input type="text" id="searchInput" placeholder="Search for products, brands, and more...">
              <button id="searchBtn"><i class="fa fa-search"></i></button>
            </div>
          </div>
          <div class="col-md-2">
            <div class="user text-right">
              <a href="wishlist.html" class="btn wishlist">
                <i class="fa fa-heart"></i>
                <span id="wishlist-count">(0)</span>
              </a>
              <a href="cart.html" class="btn cart">
                <i class="fa fa-shopping-cart"></i>
                <span id="cart-count">(0)</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Search Bar End -->

    <!-- Breadcrumb Start -->
    <div class="breadcrumb-wrap">
      <div class="container-fluid">
        <ul class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item"><a href="my-account.html">My Account</a></li>
          <li class="breadcrumb-item active">Manage Addresses</li>
        </ul>
      </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Main Content -->
    <div class="container-fluid">
      <div class="manage-addresses-container">
        <div class="manage-addresses-header">
          <h2><i class="fa fa-map-marker-alt me-2"></i>Manage Addresses</h2>
          <button class="btn add-address-btn" data-toggle="modal" data-target="#addressModal">
            <i class="fa fa-plus me-2"></i>Add New Address
          </button>
        </div>

        <!-- Selection Status -->
        <div id="selectionStatus" style="display: none">
          <div class="selection-status">
            <div>
              <h6 class="mb-1">
                <i class="fa fa-check-circle text-success me-2"></i>Address Selected for Checkout
              </h6>
              <p class="mb-0" id="selectedAddressInfo"></p>
            </div>
          </div>
        </div>

        <!-- No Selection Message -->
        <div id="noSelectionMessage" class="no-selection-msg" style="display: none">
          <i class="fa fa-exclamation-triangle me-2"></i>
          No address selected. Please select an address for checkout.
        </div>

        <!-- Addresses List -->
        <div id="addressesContainer">
          <div class="loading-state">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Loading...</span>
            </div>
            <p>Loading your addresses...</p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons-container" id="actionButtons" style="display: none">
          <a href="checkout.html" class="btn proceed-checkout-btn">
            <i class="fa fa-shopping-cart me-2"></i>Proceed to Checkout
          </a>
          <button class="btn add-address-btn" data-toggle="modal" data-target="#addressModal">
            <i class="fa fa-plus me-2"></i>Add Another Address
          </button>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none">
          <i class="fa fa-map-marker-alt"></i>
          <h4>No Addresses Found</h4>
          <p class="text-muted">
            You haven't added any addresses yet. Add your first address to get started.
          </p>
          <button class="btn add-address-btn" data-toggle="modal" data-target="#addressModal">
            <i class="fa fa-plus me-2"></i>Add Your First Address
          </button>
        </div>
      </div>
    </div>

    <!-- Add/Edit Address Modal -->
    <div class="modal fade" id="addressModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">Add New Address</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addressForm">
              <input type="hidden" id="addressId" />
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" class="form-control" id="fullName" required />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="text" class="form-control" id="phone" required />
                    <small class="form-text text-muted">10-digit mobile number</small>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">House/Building/Apartment *</label>
                <input type="text" class="form-control" id="house" required />
              </div>

              <div class="form-group">
                <label class="form-label">Street/Locality</label>
                <input type="text" class="form-control" id="street" />
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">City *</label>
                    <input type="text" class="form-control" id="city" required />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">State *</label>
                    <input type="text" class="form-control" id="state" required />
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Pin Code *</label>
                    <input type="text" class="form-control" id="pinCode" required />
                    <small class="form-text text-muted">6-digit postal code</small>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Country</label>
                    <input type="text" class="form-control" id="country" value="India" readonly />
                    <small class="form-text text-muted">Currently we only deliver to India</small>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="isDefault" />
                  <label class="form-check-label" for="isDefault">
                    Set as default address
                  </label>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="saveAddressBtn">Save Address</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Start -->
    <div class="footer">
      <div class="container-fluid">
        <div class="row">
          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <h2>ShopStyle</h2>
              <div class="contact-info">
                <p><i class="fa fa-map-marker"></i>123 Business Street, New York, NY 10001</p>
                <p><i class="fa fa-envelope"></i>support@shopstyle.com</p>
                <p><i class="fa fa-phone"></i>+1 (234) 567-8900</p>
              </div>
              <div class="social">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <h2>Quick Links</h2>
              <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="product-list.html">Products</a></li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="contact.html">Contact Us</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <h2>Customer Service</h2>
              <ul>
                <li><a href="faq.html">FAQ</a></li>
                <li><a href="shipping.html">Shipping Policy</a></li>
                <li><a href="returns.html">Return Policy</a></li>
                <li><a href="privacy.html">Privacy Policy</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <h2>My Account</h2>
              <ul>
                <li><a href="my-account.html">My Account</a></li>
                <li><a href="order-history.html">Order History</a></li>
                <li><a href="wishlist.html">Wishlist</a></li>
                <li><a href="newsletter.html">Newsletter</a></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="row payment align-items-center">
          <div class="col-md-6">
            <div class="payment-method">
              <h3>We Accept:</h3>
              <img src="img/payment-method.png" alt="Payment Methods">
            </div>
          </div>
          <div class="col-md-6">
            <div class="payment-security">
              <h3>Secured By:</h3>
              <img src="img/godaddy.svg" alt="GoDaddy">
              <img src="img/norton.svg" alt="Norton">
              <img src="img/ssl.svg" alt="SSL">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <p>&copy; 2024 ShopStyle. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-right">
            <p>Designed with <i class="fa fa-heart text-danger"></i> for modern eCommerce</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Back to Top -->
    <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/slick/slick.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

    <!-- Template Javascript -->
    <script>
      // ========== NOTYF NOTIFICATION SETUP ==========
      const notyf = new Notyf({
        duration: 3000,
        position: {
          x: 'right',
          y: 'top',
        },
        types: [
          {
            type: 'success',
            background: '#10b981',
            icon: {
              className: 'fas fa-check-circle',
              tagName: 'i',
              color: '#fff'
            }
          },
          {
            type: 'error',
            background: '#ef4444',
            icon: {
              className: 'fas fa-exclamation-circle',
              tagName: 'i',
              color: '#fff'
            }
          },
          {
            type: 'warning',
            background: '#f59e0b',
            icon: {
              className: 'fas fa-exclamation-triangle',
              tagName: 'i',
              color: '#fff'
            }
          },
          {
            type: 'info',
            background: '#3b82f6',
            icon: {
              className: 'fas fa-info-circle',
              tagName: 'i',
              color: '#fff'
            }
          }
        ]
      });

      let addresses = [];
      let selectedAddressId = null;
      let redirectTimer = null;

      // Load addresses when page loads
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Page loaded");
        
        checkAuthAndUpdateUI();
        loadAddresses();
        setupEventListeners();

        // Check if there's a previously selected address
        selectedAddressId = localStorage.getItem("selectedAddressId");
      });

      function setupEventListeners() {
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');

        if (searchInput && searchBtn) {
          searchInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
              handleSearch();
            }
          });

          searchBtn.addEventListener('click', function (e) {
            e.preventDefault();
            handleSearch();
          });
        }

        // Save address button
        document.getElementById("saveAddressBtn").addEventListener("click", saveAddress);

        // Modal reset when closed
        $('#addressModal').on('hidden.bs.modal', function () {
          resetForm();
        });

        // Logout functionality
        document.getElementById("logoutBtn").addEventListener("click", logoutUser);

        // Add address buttons
        document.querySelectorAll(".add-address-btn").forEach(btn => {
          if (!btn.dataset.listenerAdded) {
            btn.addEventListener("click", function () {
              document.getElementById("modalTitle").textContent = "Add New Address";
              document.getElementById("addressId").value = "";
            });
            btn.dataset.listenerAdded = true;
          }
        });
      }

      function handleSearch() {
        const query = document.getElementById('searchInput').value.trim();

        if (!query) {
          notyf.error('Please enter something to search');
          return;
        }
        window.location.href = `product-list.html?search=${encodeURIComponent(query)}`;
      }

      // Check authentication and update UI
      function checkAuthAndUpdateUI() {
        const token = localStorage.getItem("token");
        const isLoggedIn = !!token;

        if (isLoggedIn) {
          // Hide login button, show user account
          document.getElementById("loginBtn").style.display = "none";
          document.getElementById("userAccountDropdown").style.display = "block";

          // Show protected menu items
          document.querySelectorAll(".protected-menu").forEach((item) => {
            item.style.display = "block";
          });

          // Load cart count
          loadCartCount();
        } else {
          // Show login button, hide user account
          document.getElementById("loginBtn").style.display = "inline-block";
          document.getElementById("userAccountDropdown").style.display = "none";

          // Hide protected menu items
          document.querySelectorAll(".protected-menu").forEach((item) => {
            item.style.display = "none";
          });
          
          // Redirect to login if not logged in
          notyf.error("Please login to access address management");
          setTimeout(() => {
            window.location.href = "login.html";
          }, 1500);
        }
      }

      // Load cart count from API
      async function loadCartCount() {
        const token = localStorage.getItem("token");
        if (!token) {
          console.log("No token found, skipping cart count");
          return;
        }

        try {
          console.log("ðŸ›’ Loading cart count...");
          const response = await fetch("http://localhost:8070/api/user/cart/getAll", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const data = await response.json();
            console.log("ðŸ›’ Cart data:", data);

            let cartCount = 0;

            if (data.success && data.cart && data.cart.items) {
              // Calculate total items in cart
              cartCount = data.cart.items.reduce(
                (total, item) => total + (item.quantity || 0),
                0
            );
            } else if (data.success && data.cartItems) {
              // Alternative data structure
              cartCount = data.cartItems.length || 0;
            } else if (data.totalItems) {
              // Another alternative
              cartCount = data.totalItems;
            }

            updateCartCountUI(cartCount);
          } else {
            console.log("ðŸ›’ Failed to load cart, status:", response.status);
            updateCartCountUI(0);
          }
        } catch (error) {
          console.error("ðŸ›’ Error loading cart count:", error);
          updateCartCountUI(0);
        }
      }

      // Update cart count UI
      function updateCartCountUI(count) {
        const cartCountElement = document.getElementById("cart-count");
        if (cartCountElement) {
          cartCountElement.textContent = `(${count})`;
        }
      }

      // Logout function
      function logoutUser() {
        showNotyfConfirm(
          "Are you sure you want to logout?",
          "Confirm Logout"
        ).then((confirmed) => {
          if (confirmed) {
            localStorage.removeItem("token");
            localStorage.removeItem("userName");
            localStorage.removeItem("userId");
            localStorage.removeItem("selectedAddressId");

            // Clear cart count
            updateCartCountUI(0);

            // Redirect to home page
            window.location.href = "index.html";
          }
        });
      }

      async function loadAddresses() {
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "login.html";
          return;
        }

        try {
          console.log("ðŸ” Loading addresses...");
          const response = await fetch("http://localhost:8070/api/user/addresses", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          console.log("ðŸ“¡ Response status:", response.status);

          if (response.ok) {
            const data = await response.json();
            console.log("âœ… API Response data:", data);
            addresses = data.addresses || data.data || [];
            renderAddresses();
          } else {
            console.log("âŒ Response not OK");
            throw new Error("Failed to load addresses");
          }
        } catch (error) {
          console.error("Error loading addresses:", error);
          notyf.error("Error loading addresses");
        }
      }

      // Handle radio button selection
      function handleAddressSelection(addressId) {
        selectedAddressId = addressId;
        localStorage.setItem("selectedAddressId", addressId);
        
        const address = addresses.find(addr => addr._id === addressId);
        if (address) {
          // Update selection status
          updateSelectionStatus(address);
          
          // Update radio buttons
          updateRadioButtons();
        }
      }

      // Update radio buttons state
      function updateRadioButtons() {
        document.querySelectorAll('.address-radio').forEach(radio => {
          radio.checked = radio.value === selectedAddressId;
        });
        
        // Update row classes
        document.querySelectorAll('.address-row').forEach(row => {
          const addressId = row.dataset.addressId;
          if (addressId === selectedAddressId) {
            row.classList.add('selected');
          } else {
            row.classList.remove('selected');
          }
        });
      }

      // Update selection status display
      function updateSelectionStatus(address) {
        const selectionStatus = document.getElementById('selectionStatus');
        const noSelectionMessage = document.getElementById('noSelectionMessage');
        const actionButtons = document.getElementById('actionButtons');
        const selectedAddressInfo = document.getElementById('selectedAddressInfo');
        
        if (address) {
          selectedAddressInfo.textContent = 
            `${address.fullName} â€¢ ${address.phone} â€¢ ${address.city}, ${address.state}`;
          selectionStatus.style.display = 'block';
          noSelectionMessage.style.display = 'none';
          actionButtons.style.display = 'flex';
        } else {
          selectionStatus.style.display = 'none';
          noSelectionMessage.style.display = 'block';
          actionButtons.style.display = 'flex';
        }
      }

      function renderAddresses() {
        const container = document.getElementById("addressesContainer");
        const emptyState = document.getElementById("emptyState");
        const actionButtons = document.getElementById("actionButtons");

        console.log("ðŸŽ¨ Rendering addresses...", addresses);

        if (addresses.length === 0) {
          console.log("ðŸ“­ No addresses to display");
          container.style.display = "none";
          emptyState.style.display = "block";
          actionButtons.style.display = "none";
          return;
        }

        console.log(
          "ðŸ–¼ï¸ Creating address rows for",
          addresses.length,
          "addresses"
        );

        container.style.display = "block";
        emptyState.style.display = "none";
        actionButtons.style.display = "flex";

        // Check if we have a selected address, if not use the default
        if (
          !selectedAddressId ||
          !addresses.find((addr) => addr._id === selectedAddressId)
        ) {
          const defaultAddress = addresses.find((addr) => addr.isDefault);
          if (defaultAddress) {
            selectedAddressId = defaultAddress._id;
            localStorage.setItem("selectedAddressId", selectedAddressId);
          }
        }

        // Get selected address details
        const selectedAddress = selectedAddressId
          ? addresses.find((addr) => addr._id === selectedAddressId)
          : null;

        // Update selection status
        updateSelectionStatus(selectedAddress);

        // Create address rows
        container.innerHTML = addresses
          .map(
            (address) => `
            <div class="address-row ${
              selectedAddressId === address._id ? "selected" : ""
            } ${address.isDefault ? "default" : ""}" data-address-id="${
              address._id
            }">
              <div class="address-selection">
                <div class="form-check">
                  <input 
                    class="form-check-input address-radio" 
                    type="radio" 
                    name="addressSelection" 
                    value="${address._id}" 
                    ${selectedAddressId === address._id ? "checked" : ""}
                    onchange="handleAddressSelection('${address._id}')"
                  >
                </div>
              </div>
              
              <div class="address-details">
                <div class="address-details-header">
                  <h6 class="address-name">${address.fullName}</h6>
                  ${
                    address.isDefault
                      ? '<span class="address-type-badge"><span class="badge bg-success"><i class="fa fa-star me-1"></i>Default</span></span>'
                      : ""
                  }
                </div>
                
                <div class="address-info">
                  <p><i class="fa fa-home"></i> ${address.house}</p>
                  ${
                    address.street
                      ? `<p><i class="fa fa-road"></i> ${address.street}</p>`
                      : ""
                  }
                  <p><i class="fa fa-city"></i> ${address.city}, ${
              address.state
            } - ${address.pinCode}</p>
                  <p><i class="fa fa-phone"></i> ${address.phone}</p>
                </div>
              </div>
              
              <div class="address-actions">
                <button class="btn btn-set-default" onclick="setDefaultAddress('${
                  address._id
                }')">
                  <i class="fa fa-star me-1"></i>Set Default
                </button>
                <button class="btn btn-edit" onclick="editAddress('${
                  address._id
                }')">
                  <i class="fa fa-edit me-1"></i>Edit
                </button>
                <button class="btn btn-delete" onclick="deleteAddress('${
                  address._id
                }')">
                  <i class="fa fa-trash me-1"></i>Delete
                </button>
              </div>
            </div>
          `
          )
          .join("");

        console.log("âœ… Finished rendering addresses");
      }

      function editAddress(addressId) {
        const address = addresses.find((addr) => addr._id === addressId);
        if (!address) return;

        document.getElementById("modalTitle").textContent = "Edit Address";
        document.getElementById("addressId").value = address._id;
        document.getElementById("fullName").value = address.fullName;
        document.getElementById("phone").value = address.phone;
        document.getElementById("pinCode").value = address.pinCode;
        document.getElementById("street").value = address.street || "";
        document.getElementById("house").value = address.house;
        document.getElementById("city").value = address.city;
        document.getElementById("state").value = address.state;
        document.getElementById("country").value = address.country || "India";
        document.getElementById("isDefault").checked = address.isDefault;

        $('#addressModal').modal('show');
      }

      // Validate phone number
      function validatePhoneNumber(phone) {
        const phoneRegex = /^[0-9]{10}$/;
        return phoneRegex.test(phone);
      }

      // Validate pin code
      function validatePinCode(pinCode) {
        return pinCode.length === 6 && /^\d+$/.test(pinCode);
      }

      async function saveAddress() {
        const token = localStorage.getItem("token");
        const addressId = document.getElementById("addressId").value;
        const isEdit = !!addressId;

        const addressData = {
          fullName: document.getElementById("fullName").value.trim(),
          phone: document.getElementById("phone").value.trim(),
          pinCode: document.getElementById("pinCode").value.trim(),
          street: document.getElementById("street").value.trim(),
          house: document.getElementById("house").value.trim(),
          city: document.getElementById("city").value.trim(),
          state: document.getElementById("state").value.trim(),
          country: document.getElementById("country").value.trim(),
          isDefault: document.getElementById("isDefault").checked,
        };

        // Basic validation
        if (
          !addressData.fullName ||
          !addressData.phone ||
          !addressData.pinCode ||
          !addressData.house ||
          !addressData.city ||
          !addressData.state
        ) {
          notyf.error("Please fill all required fields");
          return;
        }

        // Phone validation
        if (!validatePhoneNumber(addressData.phone)) {
          notyf.error("Please enter a valid 10-digit phone number");
          return;
        }

        // Pin code validation
        if (!validatePinCode(addressData.pinCode)) {
          notyf.error("Please enter a valid 6-digit pin code");
          return;
        }

        try {
          const url = isEdit
            ? `http://localhost:8070/api/user/addresses/${addressId}`
            : "http://localhost:8070/api/user/addresses";
          const method = isEdit ? "PUT" : "POST";

          console.log("ðŸ“¤ Saving address:", {
            url,
            method,
            isEdit,
            addressData
          });

          // Show loading state
          const saveBtn = document.getElementById("saveAddressBtn");
          const originalBtnText = saveBtn.innerHTML;
          saveBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Saving...';
          saveBtn.disabled = true;

          const response = await fetch(url, {
            method: method,
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify(addressData),
          });

          console.log("ðŸ“¥ Save response status:", response.status);

          // Restore button state
          saveBtn.innerHTML = originalBtnText;
          saveBtn.disabled = false;

          // Try to parse response
          let responseData;
          try {
            responseData = await response.json();
            console.log("ðŸ“¥ Save response data:", responseData);
          } catch (jsonError) {
            console.log("ðŸ“¥ No JSON response or parse error:", jsonError);
            responseData = {};
          }

          if (response.ok) {
            // Close modal
            $('#addressModal').modal('hide');
            resetForm();
            
            // Show success message
            const message = isEdit ? "Address updated successfully!" : "Address added successfully!";
            console.log("âœ… Showing success message:", message);
            
            // Show success notification
            notyf.success(message);
            
            // Clear any existing redirect timer
            if (redirectTimer) {
              clearTimeout(redirectTimer);
            }
            
            // Reload addresses
            loadAddresses();
            
          } else {
            // Handle error response
            const errorMessage = responseData.message || 
                                responseData.error || 
                                `Failed to ${isEdit ? 'update' : 'add'} address. Status: ${response.status}`;
            console.error("âŒ Save error:", errorMessage);
            notyf.error(errorMessage);
            
            // If it's a 401 error (unauthorized), redirect to login
            if (response.status === 401) {
              notyf.error("Session expired. Please login again.");
              setTimeout(() => {
                window.location.href = "login.html";
              }, 2000);
            }
          }
        } catch (error) {
          console.error("ðŸ’¥ Network/Request error:", error);
          notyf.error("Network error. Please check your connection.");
          
          // Restore button state in case of error
          const saveBtn = document.getElementById("saveAddressBtn");
          saveBtn.innerHTML = "Save Address";
          saveBtn.disabled = false;
        }
      }

      async function deleteAddress(addressId) {
        const address = addresses.find((addr) => addr._id === addressId);
        if (!address) return;

        // Show custom confirmation dialog
        showNotyfConfirm(
          `Are you sure you want to delete the address for ${address.fullName}?`,
          "Confirm Deletion"
        ).then(async (confirmed) => {
          if (!confirmed) return;

          const token = localStorage.getItem("token");
          try {
            const response = await fetch(`http://localhost:8070/api/user/addresses/${addressId}`, {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            });

            if (response.ok) {
              // If deleted address was selected, clear selection
              if (selectedAddressId === addressId) {
                selectedAddressId = null;
                localStorage.removeItem("selectedAddressId");
                notyf.info(
                  `Address "${address.fullName}" deleted and unselected`
                );
              } else {
                notyf.success("Address deleted successfully");
              }

              loadAddresses();
            } else {
              throw new Error("Failed to delete address");
            }
          } catch (error) {
            console.error("Error deleting address:", error);
            notyf.error("Error deleting address");
          }
        });
      }

      async function setDefaultAddress(addressId) {
        const address = addresses.find((addr) => addr._id === addressId);
        if (!address) return;

        const token = localStorage.getItem("token");
        try {
          const response = await fetch(`http://localhost:8070/api/user/addresses/${addressId}`, {
            method: "PUT",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ isDefault: true }),
          });

          if (response.ok) {
            // If no address is currently selected, select this one as it becomes default
            if (!selectedAddressId) {
              selectedAddressId = addressId;
              localStorage.setItem("selectedAddressId", addressId);
              notyf.success(
                `Address set as default and selected: ${address.fullName}`
              );
            } else {
              notyf.success("Address set as default successfully");
            }

            loadAddresses();
          } else {
            throw new Error("Failed to set default address");
          }
        } catch (error) {
          console.error("Error setting default address:", error);
          notyf.error("Error setting default address");
        }
      }

      function resetForm() {
        document.getElementById("addressForm").reset();
        document.getElementById("addressId").value = "";
        document.getElementById("country").value = "India";
      }

      // Custom confirmation dialog function using Notyf
      function showNotyfConfirm(message, title = "Confirm") {
        return new Promise((resolve) => {
          // Create a custom notification
          const confirmNotification = notyf.open({
            type: 'warning',
            duration: 0, // No auto-dismiss
            message: `
              <div style="text-align: left; padding: 10px;">
                <h6 style="margin-bottom: 10px;">${title}</h6>
                <p style="margin-bottom: 15px;">${message}</p>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                  <button id="confirmCancel" class="btn btn-sm btn-secondary" style="padding: 5px 15px;">Cancel</button>
                  <button id="confirmOk" class="btn btn-sm btn-primary" style="padding: 5px 15px;">Confirm</button>
                </div>
              </div>
            `,
            dismissible: false
          });

          // Add event listeners to buttons
          setTimeout(() => {
            const cancelBtn = document.getElementById('confirmCancel');
            const okBtn = document.getElementById('confirmOk');
            
            if (cancelBtn) {
              cancelBtn.onclick = function() {
                notyf.dismiss(confirmNotification);
                resolve(false);
              };
            }
            
            if (okBtn) {
              okBtn.onclick = function() {
                notyf.dismiss(confirmNotification);
                resolve(true);
              };
            }
          }, 100);
        });
      }
    </script>
  </body>
</html>