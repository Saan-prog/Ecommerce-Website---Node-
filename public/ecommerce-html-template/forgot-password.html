<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ShopStyle - Forgot Password</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="eCommerce HTML Template Free Download" name="keywords">
    <meta content="eCommerce HTML Template Free Download" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400|Source+Code+Pro:700,900&display=swap" rel="stylesheet">

    <!-- CSS Libraries -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="lib/slick/slick.css" rel="stylesheet">
    <link href="lib/slick/slick-theme.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Top bar Start -->
    <div class="top-bar">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <i class="fa fa-envelope"></i>
                    support@email.com
                </div>
                <div class="col-sm-6">
                    <i class="fa fa-phone-alt"></i>
                    +012-345-6789
                </div>
            </div>
        </div>
    </div>
    <!-- Top bar End -->
    
    <!-- Navigation (Same as your other pages) -->
    <div class="nav">
        <div class="container-fluid">
            <nav class="navbar navbar-expand-md bg-dark navbar-dark">
                <!-- Your navigation code here -->
            </nav>
        </div>
    </div>
    
    <!-- Bottom Bar (Same as your other pages) -->
    <div class="bottom-bar">
        <div class="container-fluid">
            <div class="row align-items-center">
                <!-- Your bottom bar code here -->
            </div>
        </div>
    </div>
    
    <!-- Breadcrumb Start -->
    <div class="breadcrumb-wrap">
        <div class="container-fluid">
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item"><a href="login.html">Login</a></li>
                <li class="breadcrumb-item active">Forgot Password</li>
            </ul>
        </div>
    </div>
    <!-- Breadcrumb End -->
    
    <!-- Forgot Password Start -->
    <div class="login">
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-lg-6 col-md-8">
                    <div class="login-form shadow">
                        <h2 class="form-heading text-center">Forgot Password</h2>
                        <p class="text-center text-muted mb-4">
                            Enter your email address and we'll send you a link to reset your password.
                        </p>
                        
                        <form id="forgotPasswordForm">
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input class="form-control" type="email" id="email" name="email" 
                                       placeholder="Enter your email address" required>
                            </div>
                            
                            <button type="submit" class="form-btn" id="submitBtn">
                                Send Reset Link
                            </button>
                            
                            <div class="text-center mt-3">
                                <p>Remember your password? <a href="login.html">Back to Login</a></p>
                            </div>
                        </form>

                        <div id="successMessage" class="alert alert-success mt-3" style="display: none;">
                            <i class="fa fa-check-circle"></i>
                            <span id="successText"></span>
                        </div>

                        <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;">
                            <i class="fa fa-exclamation-circle"></i>
                            <span id="errorText"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Forgot Password End -->
    
    <!-- Footer (Same as your other pages) -->
    <div class="footer">
        <!-- Your footer code here -->
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.getElementById("forgotPasswordForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            console.log("üü¢ Form submitted");
            
            const email = document.getElementById("email").value.trim();
            const submitBtn = document.getElementById("submitBtn");
            const successMessage = document.getElementById("successMessage");
            const errorMessage = document.getElementById("errorMessage");
            
            console.log("üìß Email entered:", email);
            // Reset messages
            successMessage.style.display = "none";
            errorMessage.style.display = "none";
            
            // Validate email
            if (!email) {
                console.log("‚ùå No email provided");
                showError("Please enter your email address.");
                return;
            }
            
            if (!isValidEmail(email)) {
                console.log("‚ùå Invalid email format");
                showError("Please enter a valid email address.");
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Sending...';
            
            try {
                console.log("üü° Making API request...");

                const response = await fetch("/api/user/forgot-password", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email })
                });

                console.log("üü¢ Response status:", response.status);
                
                const data = await response.json();
                
                        console.log("üü¢ Response data:", data); // Add this

                if (response.ok) {
                    console.log("‚úÖ Success response");
                    showSuccess(data.message);
                    document.getElementById("forgotPasswordForm").reset();
                    
                    // Show reset link in development
                    if (data.resetLink) {
                        console.log("üîó Reset link:", data.resetLink);
                        // const devInfo = document.createElement("div");
                        // devInfo.className = "alert alert-info mt-3";
                        // devInfo.innerHTML = `<strong>Development Info:</strong> <a href="${data.resetLink}" target="_blank">${data.resetLink}</a>`;
                        // successMessage.after(devInfo);
                    }
                } else {
                    showError(data.message || "Failed to send reset link. Please try again.");
                }
            } catch (err) {
                console.error("Forgot password error:", err);
                showError("Network error. Please check your connection and try again.");
            } finally {
                // Reset button
                submitBtn.disabled = false;
                submitBtn.innerHTML = "Send Reset Link";
            }
        });

        function showLoading(){
            const submitBtn = document.getElementById("submitBtn");
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<i class="fa fa-spinner fa-spin"> </i> sending..`;
        }

        function hideLoading (){
            const submitBtn = document.getElementById("submitBtn");
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Send Rest Link';
        }
        
        function showSuccess(message) {
            const successMessage = document.getElementById("successMessage");
            const successText = document.getElementById("successText");
            successText.textContent = message;
            successMessage.style.display = "block";
        }
        
        function showError(message) {
            const errorMessage = document.getElementById("errorMessage");
            const errorText = document.getElementById("errorText");
            errorText.textContent = message;
            errorMessage.style.display = "block";
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
    </script>
</body>
</html>